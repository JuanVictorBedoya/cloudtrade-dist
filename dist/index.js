!function(e){function t(r){if(n[r])return n[r].exports;var a=n[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var n={};t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=43)}([function(e,t){e.exports=require("babel-runtime/helpers/classCallCheck")},function(e,t){e.exports=require("babel-runtime/helpers/createClass")},function(e,t){e.exports=require("babel-runtime/core-js/object/get-prototype-of")},function(e,t){e.exports=require("babel-runtime/helpers/inherits")},function(e,t){e.exports=require("babel-runtime/helpers/possibleConstructorReturn")},function(e,t){e.exports=require("babel-runtime/regenerator")},function(e,t){e.exports=require("co")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(0),i=r(a),s=n(1),u=r(s),o=n(87),c=r(o);c.default.locale("es"),e.exports=function(){function e(t){(0,i.default)(this,e)}return(0,u.default)(e,null,[{key:"now",value:function(){return(0,c.default)().format("L LTS")}},{key:"parse",value:function(e){var t=e.split("/");return new Date(t[2]+" "+t[1]+" "+t[0])}}]),e}()},function(e,t){e.exports=require("mongoose")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(11),i=r(a),s=n(75),u=r(s),o=n(5),c=r(o),d=n(0),l=r(d),f=n(1),p=r(f),h=n(6),m=r(h);e.exports=function(){function e(){(0,l.default)(this,e),this._transacts=[]}return(0,p.default)(e,[{key:"insert",value:function(t,n){var r=this;return(0,m.default)(c.default.mark(function a(){var i,s;return c.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return i=new t(n),a.next=3,e.execTimeout(4e3,function(){return i.save()});case 3:return s=a.sent,r._transacts.push({Model:t,type:"insert",doc:i}),a.abrupt("return",s);case 6:case"end":return a.stop()}},a,this)}))}},{key:"update",value:function(t,n,r){var a=this;return(0,m.default)(c.default.mark(function i(){var s,o;return c.default.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,t.findOne(n);case 2:if(!(s=i.sent)){i.next=11;break}return i.next=6,e.execTimeout(4e3,function(){return t.update(n,{$set:r})});case 6:return o=i.sent,a._transacts.push({Model:t,type:"update",query:n,doc:s}),i.abrupt("return",o);case 11:throw"Elemento "+(0,u.default)(n)+" no encontrado en base de datos";case 12:case"end":return i.stop()}},i,this)}))}},{key:"run",value:function(e){var t=this;return new i.default(function(n,r){(0,m.default)(e()).then(function(e){n(e)}).catch(function(e){t.rollback(),r(e)})})}},{key:"rollback",value:function(){for(console.log("ROLLBACK TRANSACTION");this._transacts.length>0;){var e=this._transacts.pop();switch(e.type){case"insert":e.doc.remove().then(function(e){}).catch(function(e){console.log("INSERT ROLLBACK ERROR",e)});break;case"update":e.Model.update(e.query,{$set:e.doc}).then(function(e){}).catch(function(e){console.log("UPDATE ROLLBACK ERROR",e)})}}}}],[{key:"execTimeout",value:function(e,t,n){return new i.default(function(r,a){var i=!0;(0,m.default)(c.default.mark(function r(){var s;return c.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return s=t(),setTimeout(function(){if(i){if(s.then){s.then().then(function(e){n&&n(e)}).catch(function(){})}i=!1,a({message:"No se pudieron leer los datos, la respuesta tardó demasiado"})}},e),r.next=4,s;case 4:return r.abrupt("return",r.sent);case 5:case"end":return r.stop()}},r,this)})).then(function(e){i=!1,r(e)}).catch(function(e){i=!1,a(e)})})}}]),e}()},function(e,t){e.exports=require("randomstring")},function(e,t){e.exports=require("babel-runtime/core-js/promise")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("passport")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(2),i=r(a),s=n(0),u=r(s),o=n(1),c=r(o),d=n(4),l=r(d),f=n(3),p=r(f),h=n(15),m=r(h),v=n(74),y=r(v),b=n(64),g=r(b),x=n(65),k=r(x),w=n(23),E=r(w);e.exports=function(e){function t(e,n){(0,u.default)(this,t);var r=(0,l.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return r._subName=n,r}return(0,p.default)(t,e),(0,c.default)(t,[{key:"assetsFromTheme",value:function(e){var t={styleSheets:e.styleSheets,scripts:e.scripts};return this.onLoadAssets(e,t),t}},{key:"onLoadAssets",value:function(e,t){var n=this;if(this._subName){var r=e.routes.find(function(e){return e.name===n._subName});r&&(r.styleSheets&&(t.styleSheets=t.styleSheets.concat(r.styleSheets)),r.scripts&&(t.scripts=t.scripts.concat(r.scripts)))}}},{key:"render",value:function(){var e=y.default.load(this.props.themeName),t=this.assetsFromTheme(e);return m.default.createElement("html",null,m.default.createElement(g.default,{iconName:E.default.RC_ICON_APP,title:E.default.STR_COMPANY_NAME,styleSheets:t.styleSheets},m.default.createElement("meta",{name:"theme-color",content:e.htmlColor}),m.default.createElement("link",{href:"http://fonts.googleapis.com/icon?family=Material+Icons",rel:"stylesheet"}),this.props.headScripts),m.default.createElement("body",null,m.default.createElement("div",{id:"app-main"})),m.default.createElement(k.default,{scripts:t.scripts}))}}]),t}(m.default.Component)},function(e,t){e.exports=require("react")},function(e,t){e.exports=require("babel-runtime/core-js/get-iterator")},function(e,t){e.exports=require("colors")},function(e,t){e.exports=require("path")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(0),i=r(a),s=n(1),u=r(s);e.exports=function(){function e(){(0,i.default)(this,e)}return(0,u.default)(e,null,[{key:"std",value:function(e){return{responseStatus:e.responseStatus||500,statusText:"",message:e.message||"Error: "+e}}}]),e}()},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(5),i=r(a),s=n(0),u=r(s),o=n(1),c=r(o),d=n(25),l=r(d),f=n(18),p=r(f),h=n(6),m=r(h),v=n(81),y=r(v),b=n(92),g=r(b);e.exports=function(){function e(t,n,r){(0,u.default)(this,e),this._fileName=n,this._fileDir=r?t:p.default.join(__dirname,t),this._filePath=p.default.join(this._fileDir,this._fileName),console.log(this._filePath)}return(0,c.default)(e,null,[{key:"readToBuffer",value:function(e,t){return(0,m.default)(i.default.mark(function n(){var r,a,s;return i.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r=p.default.join(__dirname,e),a=p.default.join(r,t),!l.default.existsSync(a)){n.next=8;break}return s=l.default.createReadStream(a),n.next=5,(0,g.default)(s).then(function(e){for(var t=[],n=0,r=e.length;n<r;++n){var a=e[n];t.push(a instanceof Buffer?a:new Buffer(a))}return Buffer.concat(t)});case 5:return n.abrupt("return",n.sent);case 8:throw'No existe el archivo "'+self._fileName+'"';case 9:case"end":return n.stop()}},n,this)}))}},{key:"uploadMW",value:function(e,t,n){if(e.files&&e.files.file){var r=(0,y.default)(e.files.file.data);e.files.file.type=r}n()}}]),e}()},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(0),i=r(a),s=n(1),u=r(s),o=n(18),c=(r(o),n(15)),d=r(c),l=n(22),f=n(70),p=r(f),h=n(73),m=r(h),v=n(72),y=r(v),b=n(67),g=r(b),x=n(66),k=r(x),w=n(68),E=r(w),S=n(71),C=r(S),D=n(69),_=r(D);e.exports=function(){function e(){(0,i.default)(this,e)}return(0,u.default)(e,null,[{key:"view",value:function(e){switch(e){case"home":return(0,l.renderToString)(d.default.createElement(p.default,null));case"tabletec":return(0,l.renderToString)(d.default.createElement(m.default,null));case"signup":var t=d.default.createElement("script",{key:0,src:"https://www.google.com/recaptcha/api.js?render=explicit",async:!0,defer:!0});return(0,l.renderToString)(d.default.createElement(y.default,{headScripts:[t]}));case"account":return(0,l.renderToString)(d.default.createElement(g.default,null));case"about":return(0,l.renderToString)(d.default.createElement(k.default,null));case"adm-home":return(0,l.renderToString)(d.default.createElement(E.default,null));case"inventory":return(0,l.renderToString)(d.default.createElement(C.default,null));case"error":return(0,l.renderToString)(d.default.createElement(_.default,null));default:return null}}}]),e}()},function(e,t){e.exports=require("react-dom/server")},function(e,t,n){"use strict";e.exports={PORT:2e3,STR_COMPANY_NAME:"CluodTrade",STR_COMPANY_L1:"Inventarios y almacenes",STR_RECAPTCHA_PUBLIC_KEY:"6LeP1SEUAAAAAH8Q8mimH_ke9iY2heAG23NGofBY",STR_RECAPTCHA_PRIVATE_KEY:"6LeP1SEUAAAAAIafLAxPfvl3qoG5mvheagUdd7bp",RC_ICON_APP:"icons/tabletec-icon.png"}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(5),i=r(a),s=n(11),u=r(s),o=n(0),c=r(o),d=n(1),l=r(d),f=n(91),p=r(f),h=n(86),m=r(h),v=n(6),y=r(v),b=n(90),g=r(b),x=n(17),k=r(x),w=n(19),E=r(w),S={private:"-----BEGIN RSA PRIVATE KEY-----\nMIIEowIBAAKCAQEAz7pZEypvrFJCDshsbOamj9bmy/dXnUOyCo5b3xSvvTNIoFAC\n5ePXozCD/5Byih1JB6ZYE6OceEW6oArkPzZOl8bFBlqV9k30oerMtVei18+CfF/u\nFLWlJXs9FvXrRTKtsL43OmpLCH3LdzK9/+ZqhEx/TShp3JudUWuRW8ALqrBd8QW5\nCWJHYozYVaIpFzwJ9KW6fJ9GpZfcToCOquLWo8iINnAovXmvcAtdmzgIqoucD988\nf9oerll/CubJLy2rOiyeRvsAYouoefoyQZWN8IYPlnb5IB6Z7qnVL6rZz44dAjVw\nS3uARW3lxpfeZn3TN7wpPkBssGBF0OSEHNrXVwIDAQABAoIBAC8HHCVnpRKZKNVZ\n8JoS+cB0wZmJrK8w5TzYj9oIP+UQmC+bDZzoISiT0j5ogFXeXWs68JO5pbHg72hO\nLvBUpiRcXryag3rYmTqTArdHWNmM5BiuSyMrIHFE3ka1dAcdew8ZcT1rVQNeH1Mk\nDLnDe3fqLaPVM2o7XLlTJfxklP+WN6xWhBgDVgEawneo5svdgblYhg3u7cb4fsHg\ncAf0sCYraVuqcUHa/AUVOx7n5U39x3ShOvOQvFlWEDD6uN4Yg/twW2UyfFDWD57p\n2oPIEf06wOOu2XylPQwEU9w92Fr4yNqk0xksn8sOjbRyEPZncpDICsPTo1nsrz+R\n0AcwWUkCgYEA7DfUujbbg6WrfSOyS718kTeej0Il5z19JYu11g+Sis4r8RWbT92q\nweCp4dCGCpJrsPbs4+s4hT42sKfjUcUy5ZCGTDturQNbhH0RGxPp1KUTrytzdph8\n4mqpCVYcN1AmLCCA0WtFqJ53taWuipcLtU48ZRC4jHI+stUSNCtaE8UCgYEA4R+6\nx5mUjOWAK8GSTgHMWa72KqaxR/osYwmMPtHtjIFm1aOElQaXbGlZKd3dR5Tnw/4R\n8hO/gJc+eQeaPGhri0IVmG66JNTw8q0M0Qd+l0OrarYS5c09XzjAUdGOatstsaNE\nrhgRG90HvVYt0cHyKRa/C4+CnEBod/EoS/UnhGsCgYB5wT1Qzj3PWXFPCzs3du/i\nGf0Mclf/HN6In76WG2i5SxOzLCPlwqflTtvBnS25/Uas7FmmEPQNGcguvhqZZz+Y\nvCm82VVusDBX1e8fOeBozr2aqJbXJjoYqkl+mnfoutMyI37Ccrxw8V1ar4+Lt9c9\nGJpgrYGyQqC2pMTBRyci0QKBgHxc9uXE5ddgAQorCROm0qjIipzNMSo9/b9ISv15\nIu13nsNubZOV7JirKeKC+fbNP6t585fzaNs0sgJSPNYaKS7o9t0abiJisCifiHEA\n3uHZNBzjMFVaqAiuZS/NwAsvwXJca1hxWyI1XE0wCmfR6GDie+96/AAtZIi95DDx\n4T65AoGBAIE5LSP+glxJEd8jU/qc80D/dXf6icURyYDGARw8mziAgw6fL9cwbmqb\nIGDxP1ke2FA8OZ0W4VybRi9UcprenvADYpPb+CPZv4gxGoDFg0Bb/JcFUKL29hC1\nsteX0GR4TKYNeXLC+zz7Qr0DzhpqRswSyHG5GckkIRdgHx4l/Uza\n-----END RSA PRIVATE KEY-----",public:"-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAz7pZEypvrFJCDshsbOam\nj9bmy/dXnUOyCo5b3xSvvTNIoFAC5ePXozCD/5Byih1JB6ZYE6OceEW6oArkPzZO\nl8bFBlqV9k30oerMtVei18+CfF/uFLWlJXs9FvXrRTKtsL43OmpLCH3LdzK9/+Zq\nhEx/TShp3JudUWuRW8ALqrBd8QW5CWJHYozYVaIpFzwJ9KW6fJ9GpZfcToCOquLW\no8iINnAovXmvcAtdmzgIqoucD988f9oerll/CubJLy2rOiyeRvsAYouoefoyQZWN\n8IYPlnb5IB6Z7qnVL6rZz44dAjVwS3uARW3lxpfeZn3TN7wpPkBssGBF0OSEHNrX\nVwIDAQAB\n-----END PUBLIC KEY-----"},C=function(){function e(t){(0,c.default)(this,e),this.passport=t,t.use("jwt",new g.default(this.authorize.bind(this)))}return(0,l.default)(e,[{key:"sign",value:function(e){var t=S.private;return new u.default(function(n,r){m.default.sign(e,t,{algorithm:"RS256"},function(e,t){e?r(e):n(t)})})}},{key:"verify",value:function(e){var t=S.public;return new u.default(function(n,r){m.default.verify(e,t,{algorithms:["RS256"]},function(e,t){e?r(e):n(t)})})}},{key:"authorize",value:function(e,t){var n=this;if(e.headers&&e.headers.authorization){var r=e.headers.authorization;this.verify(r).then(function(r){n.onAuthenticate(e,r,t)}).catch(function(e){n.onUnauthorized("Credenciales de usuario inválidos",t)})}else this.onUnauthorized("El usuario no tiene credenciales",t)}},{key:"onAuthenticate",value:function(e,t,n){var r=this,a=e.app.systemdb;(0,y.default)(i.default.mark(function e(){var s,u,o;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.users.findOne({code:t.code});case 2:if(!(s=e.sent)){e.next=12;break}return u=s.emails.find(function(e){return e.current}),e.next=7,a.emails.findOne({code:u.code});case 7:o=e.sent,s.email=o.email,n(null,s),e.next=13;break;case 12:r.onUnauthorized("El usuario tiene credenciales válidos pero no se encontró registro de sus datos",n);case 13:return e.abrupt("return",{});case 14:case"end":return e.stop()}},e,this)})).then(function(e){}).catch(function(e){n(e)})}},{key:"onUnauthorized",value:function(e,t){console.log(k.default.yellow("ADVERTENCIA:",e)),t(null,!1,e)}}],[{key:"verifyCaptchaMW",value:function(e,t,n){var r=e.body.recaptcha,a=e.connection.remoteAddress;if(void 0===r||""===r||null===r){var i=E.default.std("No has enviado un codigo recaptcha");t.status(i.responseStatus).json(i)}else{var s="https://www.google.com/recaptcha/api/siteverify?secret="+e.app.defs.STR_RECAPTCHA_PRIVATE_KEY+"&response="+r+"&remoteip="+a;(0,p.default)(s,function(e,r,a){if(a=JSON.parse(a),void 0===a.success||a.success)n();else{var i=E.default.std("No se pudo verificar el recaptcha");t.status(i.responseStatus).json(i)}})}}}]),e}();e.exports=C},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("validator")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(11),i=r(a),s=n(0),u=r(s),o=n(1),c=r(o),d=n(84),l=r(d),f=n(18),p=r(f),h=n(12),m=r(h),v=n(80),y=r(v),b=n(76),g=r(b),x=n(13),k=r(x),w=n(85),E=r(w),S=n(78),C=r(S),D=n(17),_=r(D),O=n(23),q=r(O),T=n(24),A=r(T),N=n(42),P=r(N),R=n(19),W=r(R),j=n(20),M=(r(j),n(49)),z=r(M),B=n(41),F=r(B);e.exports=function(){function e(){(0,u.default)(this,e);var t=E.default.readFileSync(p.default.join(__dirname,"config.json"));this._control=(0,m.default)(),this._db=new z.default(t.db),this._mailer=new P.default,this._auth=new A.default(k.default),this._control.use(m.default.static(p.default.join(__dirname,"assets"),{maxAge:"2h"})),this._control.use((0,C.default)()),this._control.use(this.appMW.bind(this)),this._control.use((0,y.default)()),this._control.use(g.default.urlencoded({extended:!1})),this._control.use(g.default.json());var n=new F.default;this._control.use("/",this.logMW,n.router),this._control.use(this.notFound.bind(this)),this.onLoad()}return(0,c.default)(e,[{key:"onLoad",value:function(){this._server=l.default.createServer(this._control),this._server.listen(q.default.PORT,this.onStart.bind(this))}},{key:"onStart",value:function(){console.log(_.default.blue("INFORMACIÓN: El servidor está listo y escuchando por el puerto:",q.default.PORT))}},{key:"appMW",value:function(e,t,n){var r=this;e.app={defs:q.default,auth:this._auth,systemdb:this._db.systemdb,mailer:this._mailer,dbConnection:function(e){return new i.default(function(t,n){r._db.connection(e,function(e,r){e?n(e):t(r)})})}},t.sendError=function(e){var n=W.default.std(e);console.error(_.default.red(n.message)),t.status(n.responseStatus).json(n)},n()}},{key:"logMW",value:function(e,t,n){console.log(e.method,e.url),n()}},{key:"notFound",value:function(e,t){t.status(404).send("NO ENCONTRADO")}}]),e}()},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(11),i=r(a),s=n(5),u=r(s),o=n(0),c=r(o),d=n(1),l=r(d),f=n(6),p=r(f),h=n(12),m=r(h),v=n(13),y=(r(v),n(20)),b=(r(y),function(){function e(){(0,c.default)(this,e),this.router=m.default.Router(),this.router.get("/listar",this.findAll.bind(this)),this.router.get("/ver/:article",this.findOne.bind(this)),this.router.get("/listar-marcas",this.findAllBrands.bind(this)),this.router.get("/listar-categorias",this.findAllCategories.bind(this)),this.router.post("/insertar",this.insertOnePOST.bind(this)),this.router.put("/editar",this.updateOnePUT.bind(this)),this.router.post("/upload-image",this.uploadImagePOST.bind(this))}return(0,l.default)(e,[{key:"findAll",value:function(e,t){e.app.db.articles.findAll().then(function(n){t.status(200).json({articles:{columns:e.app.db.articles.getSchemaColumns(),rows:n}})}).catch(function(e){t.sendError(e)})}},{key:"findAllBrands",value:function(e,t){e.app.db.articleBrands.findAll().then(function(e){t.status(200).json({brands:e})}).catch(function(e){t.sendError(e)})}},{key:"findAllCategories",value:function(e,t){e.app.db.articleCategories.findAll().then(function(e){t.status(200).json({categories:e})}).catch(function(e){t.sendError(e)})}},{key:"findOne",value:function(e,t){var n=this;(0,p.default)(u.default.mark(function t(){var r,a;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.app.db.articles.findOne({code:e.params.article});case 2:return r=t.sent,t.next=5,n.enc(r.modImages);case 5:return a=t.sent,t.abrupt("return",{code:r.code,clientCode:r.clientCode,barCode:r.barCode,name:r.name,description:r.description,brand:r.brand,category:r.category,images:a,customFields:r.customFields,prices:r.prices,creationDate:r.creationDate,modifiedDate:r.modifiedDate});case 7:case"end":return t.stop()}},t,this)})).then(function(e){t.json({article:e})}).catch(function(e){t.sendError(e)})}},{key:"insertOnePOST",value:function(e,t){(0,p.default)(u.default.mark(function t(){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.app.db.articles.insertOne(e.body);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)})).then(function(e){t.json({article:e})}).catch(function(e){t.sendError(e)})}},{key:"updateOnePUT",value:function(e,t){(0,p.default)(u.default.mark(function t(){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.app.db.articles.updateOne({code:e.body.code},{name:e.body.name,brand:e.body.brand,category:e.body.category,description:e.body.description});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)})).then(function(e){t.json({article:e})}).catch(function(e){t.sendError(e)})}},{key:"uploadImagePOST",value:function(e,t){(0,p.default)(u.default.mark(function t(){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.app.db.images.insertOne(e.files.file);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)})).then(function(e){t.json({name:e.code})}).catch(function(e){t.sendError(e)})}},{key:"enc",value:function(e){var t=e.map(function(e){return(0,p.default)(u.default.mark(function t(){var n,r;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=new Uint8Array(e.data.buffer),r=Array.prototype.map.call(n,function(e){return String.fromCharCode(e)}).join(""),t.abrupt("return",r);case 3:case"end":return t.stop()}},t,this)}))});return i.default.all(t)}}]),e}());e.exports=b},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(5),i=r(a),s=n(0),u=r(s),o=n(1),c=r(o),d=n(12),l=r(d),f=n(13),p=r(f),h=n(6),m=r(h),v=n(28),y=r(v),b=n(36),g=r(b),x=n(30),k=r(x),w=n(31),E=r(w),S=n(33),C=r(S),D=n(34),_=r(D),O=n(35),q=r(O),T=n(32),A=r(T),N=function(){function e(){(0,u.default)(this,e),this.router=l.default.Router(),this.router.use(p.default.authenticate("jwt",{session:!1})),this.router.use(this.authorizeUserOnCompany),this.router.get("/autenticar",this.authorizeUserOnCompanyGET);var t=new y.default;this.router.use("/adm/inventarios/articulos",t.router);var n=new g.default;this.router.use("/adm/inventarios/almacenes",n.router);var r=new k.default;this.router.use("/adm/inventarios/proveedores",r.router);var a=new E.default;this.router.use("/adm/inventarios/compras",a.router);var i=new C.default;this.router.use("/adm/inventarios/transferencias",i.router);var s=new _.default;this.router.use("/adm/inventarios/almacenes-entradas",s.router);var o=new q.default;this.router.use("/adm/inventarios/almacenes-salidas",o.router);var c=new A.default;this.router.use("/adm/inventarios/reportes",c.router),this.router.use(this.notFound.bind(this))}return(0,c.default)(e,[{key:"authorizeUserOnCompanyGET",value:function(e,t){t.json({user:{code:e.user.code,name:e.user.name,email:e.user.email,role:e.user.role}})}},{key:"notFound",value:function(e,t){t.sendError({responseStatus:404,message:"No se encontró el recurso."})}},{key:"authorizeUserOnCompany",value:function(e,t,n){(0,m.default)(i.default.mark(function t(){var n,r;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.user.companies.find(function(t){return e.company.code===t.code}),t.next=3,e.app.db.staff.findOne({code:e.user.code});case 3:if(r=t.sent,!n||!r){t.next=9;break}return e.user.role=r.role,t.abrupt("return",e.user);case 9:throw"Acceso no autorizado";case 10:case"end":return t.stop()}},t,this)})).then(function(e){n()}).catch(function(e){t.sendError(e)})}},{key:"validate",value:function(e,t,n){e.company?"active"===e.company.status?n():t.sendError({responseStatus:406,message:"La empresa <"+e.company.name+"> tiene estado <"+e.company.status+">"}):t.sendError({responseStatus:404,message:"Se requiere el nombre de una empresa"})}}]),e}();e.exports=N},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(5),i=r(a),s=n(0),u=r(s),o=n(1),c=r(o),d=n(6),l=r(d),f=n(12),p=r(f),h=n(13),m=(r(h),function(){function e(){(0,u.default)(this,e),this.router=p.default.Router(),this.router.get("/listar",this.findAll.bind(this)),this.router.get("/listar-ciudades",this.findAllCities.bind(this)),this.router.get("/ver/:provider",this.findOne.bind(this)),this.router.post("/insertar",this.insertOnePOST.bind(this)),this.router.put("/editar",this.updateOnePUT.bind(this))}return(0,c.default)(e,[{key:"findAll",value:function(e,t){e.app.db.providers.findAll().then(function(n){t.status(200).json({providers:{columns:e.app.db.providers.getSchemaColumns(),rows:n}})}).catch(function(e){t.sendError(e)})}},{key:"findOne",value:function(e,t){e.app.db.providers.findOne({code:e.params.provider}).then(function(e){t.status(200).json({provider:e})}).catch(function(e){t.sendError(e)})}},{key:"findAllCities",value:function(e,t){e.app.db.cities.findAll().then(function(e){t.status(200).json({cities:e})}).catch(function(e){t.sendError(e)})}},{key:"insertOnePOST",value:function(e,t){(0,l.default)(i.default.mark(function t(){return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.app.db.providers.insertOne(e.body);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)})).then(function(e){t.json({provider:e})}).catch(function(e){t.sendError(e)})}},{key:"updateOnePUT",value:function(e,t){(0,l.default)(i.default.mark(function t(){return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.app.db.providers.updateOne({code:e.body.code},{nit:e.body.name,name:e.body.nit,phone:e.body.phone,country:e.body.country,city:e.body.city,description:e.body.description,email:e.body.email,address:e.body.address});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)})).then(function(e){t.json({provider:e})}).catch(function(e){t.sendError(e)})}}]),e}());e.exports=m},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(5),i=r(a),s=n(0),u=r(s),o=n(1),c=r(o),d=n(6),l=r(d),f=n(12),p=r(f),h=n(13),m=(r(h),function(){function e(){(0,u.default)(this,e),this.router=p.default.Router(),this.router.get("/listar",this.findAll.bind(this)),this.router.get("/ver/:purchase",this.findOne.bind(this)),this.router.post("/insertar",this.insertOnePOST.bind(this)),this.router.put("/cambiar-estado",this.updateOneStatusPUT.bind(this)),this.router.get("/listar-entregados",this.findAllDeliveredGET.bind(this)),this.router.get("/ver-articulos/:purchase",this.findOneArticlesGET.bind(this))}return(0,c.default)(e,[{key:"findAll",value:function(e,t){e.app.db.purchases.findAll().then(function(n){var r=n.map(function(e){return{code:e.code,business:e.business,order:e.order,guideNumber:e.guideNumber,status:e.status,providerName:e.providerName,contactName:e.contactName,payDate:e.payDate,billingDir:e.billingDir,shippingDir:e.shippingDir,description:e.description,creationDate:e.creationDate,modifiedDate:e.modifiedDate}});t.status(200).json({purchases:{columns:e.app.db.purchases.getSchemaColumns(),rows:r}})}).catch(function(e){t.sendError(e)})}},{key:"findOne",value:function(e,t){e.app.db.purchases.findOne({code:e.params.purchase}).then(function(e){var n={code:e.code,business:e.business,order:e.order,guideNumber:e.guideNumber,status:e.status,provider:e.modProvider,contactName:e.contactName,payDate:e.payDate,billingDir:e.billingDir,shippingDir:e.shippingDir,terms:e.terms,description:e.description,articles:e.modArticles,creationDate:e.creationDate,modifiedDate:e.modifiedDate};t.status(200).json({purchase:n})}).catch(function(e){t.sendError(e)})}},{key:"findAllDeliveredGET",value:function(e,t){e.app.db.purchases.find({status:"delivered"}).then(function(n){var r=n.map(function(e){return{code:e.code,business:e.business,order:e.order,guideNumber:e.guideNumber,status:e.status,providerName:e.providerName,contactName:e.contactName,payDate:e.payDate,billingDir:e.billingDir,shippingDir:e.shippDir,description:e.description,creationDate:e.creationDate,modifiedDate:e.modifiedDate}});t.status(200).json({purchases:{columns:e.app.db.purchases.getSchemaColumns(),rows:r}})}).catch(function(e){t.sendError(e)})}},{key:"findOneArticlesGET",value:function(e,t){e.app.db.purchases.findOne({code:e.params.purchase}).then(function(e){t.status(200).json({purchaseArticles:e.modArticles})}).catch(function(e){t.sendError(e)})}},{key:"insertOnePOST",value:function(e,t){(0,l.default)(i.default.mark(function t(){return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.app.db.purchases.insertOne(e.body);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)})).then(function(e){t.json({purchase:e})}).catch(function(e){t.sendError(e)})}},{key:"updateOneStatusPUT",value:function(e,t){(0,l.default)(i.default.mark(function t(){return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.app.db.purchases.updateOneStatus(e.body);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)})).then(function(e){t.json({purchase:e})}).catch(function(e){t.sendError(e)})}}]),e}());e.exports=m},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(11),i=r(a),s=n(5),u=r(s),o=n(16),c=r(o),d=n(2),l=r(d),f=n(0),p=r(f),h=n(1),m=r(h),v=n(4),y=r(v),b=n(3),g=r(b),x=n(6),k=r(x),w=n(12),E=r(w),S=n(15),C=r(S),D=n(22),_=n(83),O=r(_),q=n(10),T=(r(q),n(7)),A=r(T),N=function(e){function t(e){return(0,p.default)(this,t),(0,y.default)(this,(t.__proto__||(0,l.default)(t)).call(this,e))}return(0,g.default)(t,e),(0,m.default)(t,[{key:"render",value:function(){return C.default.createElement("div",{id:"pageHeader",style:{zoom:"0.67"}},C.default.createElement("div",null,C.default.createElement("span",{style:{fontSize:"8pt"}},this.props.company.name)),C.default.createElement("div",null,C.default.createElement("span",{style:{fontSize:"8pt"}},"Dirección: "+this.props.company.address)),C.default.createElement("div",null,C.default.createElement("span",{style:{fontSize:"8pt"}},"Teléfono: "+this.props.company.phone)),C.default.createElement("div",null,C.default.createElement("h6",{style:{fontSize:"9pt",margin:"0.5rem 0"}},this.props.report.name)),C.default.createElement("img",{src:this.props.company.logoUrl,style:{position:"absolute",top:"0",right:"0"}}))}}]),t}(C.default.Component),P=function(e){function t(e){return(0,p.default)(this,t),(0,y.default)(this,(t.__proto__||(0,l.default)(t)).call(this,e))}return(0,g.default)(t,e),(0,m.default)(t,[{key:"render",value:function(){return C.default.createElement("div",{id:"pageFooter",style:{zoom:"0.67"}},C.default.createElement("table",{style:{width:"100%"}},C.default.createElement("tbody",null,C.default.createElement("tr",null,C.default.createElement("td",null,C.default.createElement("div",null,C.default.createElement("span",{style:{fontSize:"8pt"}},"Reporte No "+this.props.report.clientCode)),C.default.createElement("div",null,C.default.createElement("span",{style:{fontSize:"8pt"}},"Procesado: "+this.props.report.creationDate))),C.default.createElement("td",null,C.default.createElement("div",{style:{textAlign:"right"}},C.default.createElement("span",{style:{fontSize:"8pt"}},"Página {{page}} de {{pages}}.")))))))}}]),t}(C.default.Component),R=function(e){function t(e){return(0,p.default)(this,t),(0,y.default)(this,(t.__proto__||(0,l.default)(t)).call(this,e))}return(0,g.default)(t,e),(0,m.default)(t,[{key:"render",value:function(){var e=[],t=0,n=0,r=0,a=0,i=0,s={textAlign:"center",padding:"0.2rem"},u={padding:"0.2rem"};for(var o in this.props.warehouses){var c=this.props.warehouses[o];n+=1,r+=c.stock,a+=c.totalEntry,i+=c.totalOutlet,e.push(C.default.createElement("tr",{key:t++},C.default.createElement("td",{style:s},t),C.default.createElement("td",{style:u},c.clientCode),C.default.createElement("td",{style:u},c.name),C.default.createElement("td",{style:s},c.totalEntry),C.default.createElement("td",{style:s},c.totalOutlet),C.default.createElement("td",{style:s},c.stock)))}return C.default.createElement("html",null,C.default.createElement("body",null,C.default.createElement("header",null,C.default.createElement(N,{company:this.props.company,report:this.props.report})),C.default.createElement("main",null,C.default.createElement("div",{id:"pageContent",style:{zoom:"0.67",padding:"0"}},C.default.createElement("h3",{style:{textAlign:"center",fontSize:"12pt"}},"Reporte de existencias en almacenes"),C.default.createElement("h5",{style:{fontSize:"9pt",margin:"0.1rem 0"}},"Código del artículo: ",this.props.article.clientCode),C.default.createElement("h5",{style:{fontSize:"9pt",margin:"0.1rem 0 0.5rem 0"}},"Nombre del artículo: ",this.props.article.name),C.default.createElement("table",{style:{width:"100%",fontSize:"9pt",borderTop:"0.1rem solid gray",borderBottom:"0.1rem solid gray",marginBottom:"1rem"}},C.default.createElement("thead",null,C.default.createElement("tr",null,C.default.createElement("th",{style:{padding:"0.25rem"}},"No"),C.default.createElement("th",{style:{padding:"0.25rem"}},"Cod."),C.default.createElement("th",{style:{padding:"0.25rem"}},"Nombre del Almacén"),C.default.createElement("th",{style:{padding:"0.25rem"}},"Entradas"),C.default.createElement("th",{style:{padding:"0.25rem"}},"Salidas"),C.default.createElement("th",{style:{padding:"0.25rem"}},"Stock"))),C.default.createElement("tbody",null,e)),C.default.createElement("div",null,C.default.createElement("h5",{style:{fontSize:"9pt",margin:"0.2rem"}},"Total almacenes: "+n)),C.default.createElement("div",null,C.default.createElement("h5",{style:{fontSize:"9pt",margin:"0.2rem"}},"Total stock: "+r)),C.default.createElement("div",null,C.default.createElement("h5",{style:{fontSize:"9pt",margin:"0.2rem"}},"Total entradas: "+a)),C.default.createElement("div",null,C.default.createElement("h5",{style:{fontSize:"9pt",margin:"0.2rem"}},"Total salida: "+i)))),C.default.createElement("footer",null,C.default.createElement(P,{report:this.props.report}))))}}]),t}(C.default.Component),W=function(e){function t(e){return(0,p.default)(this,t),(0,y.default)(this,(t.__proto__||(0,l.default)(t)).call(this,e))}return(0,g.default)(t,e),(0,m.default)(t,[{key:"render",value:function(){var e=[],t=0,n=0,r=0,a=0,i=0,s={textAlign:"center",padding:"0.2rem"},u={padding:"0.2rem"};for(var o in this.props.articles){var c=this.props.articles[o];n+=1,r+=c.stock,a+=c.totalEntry,i+=c.totalOutlet,e.push(C.default.createElement("tr",{key:t++},C.default.createElement("td",{style:s},t),C.default.createElement("td",{style:u},c.clientCode),C.default.createElement("td",{style:u},c.name),C.default.createElement("td",{style:s},c.totalEntry),C.default.createElement("td",{style:s},c.totalOutlet),C.default.createElement("td",{style:s},c.stock)))}return C.default.createElement("html",null,C.default.createElement("body",null,C.default.createElement("header",null,C.default.createElement(N,{company:this.props.company,report:this.props.report})),C.default.createElement("main",null,C.default.createElement("div",{id:"pageContent",style:{zoom:"0.67",padding:"0"}},C.default.createElement("h3",{style:{textAlign:"center",fontSize:"12pt"}},"Reporte de existencias en almacén"),C.default.createElement("h5",{style:{fontSize:"9pt",margin:"0.1rem 0"}},"Código del almacén: ",this.props.warehouse.clientCode),C.default.createElement("h5",{style:{fontSize:"9pt",margin:"0.1rem 0 0.5rem 0"}},"Nombre del almacén: ",this.props.warehouse.name),C.default.createElement("table",{style:{width:"100%",fontSize:"9pt",borderTop:"0.1rem solid gray",borderBottom:"0.1rem solid gray",marginBottom:"1rem"}},C.default.createElement("thead",null,C.default.createElement("tr",null,C.default.createElement("th",{style:{padding:"0.25rem"}},"No"),C.default.createElement("th",{style:{padding:"0.25rem"}},"Cod."),C.default.createElement("th",{style:{padding:"0.25rem"}},"Artículo"),C.default.createElement("th",{style:{padding:"0.25rem"}},"Entradas"),C.default.createElement("th",{style:{padding:"0.25rem"}},"Salidas"),C.default.createElement("th",{style:{padding:"0.25rem"}},"Stock"))),C.default.createElement("tbody",null,e)),C.default.createElement("div",null,C.default.createElement("h5",{style:{fontSize:"9pt",margin:"0.2rem"}},"Total artículos: "+n)),C.default.createElement("div",null,C.default.createElement("h5",{style:{fontSize:"9pt",margin:"0.2rem"}},"Total stock: "+r)),C.default.createElement("div",null,C.default.createElement("h5",{style:{fontSize:"9pt",margin:"0.2rem"}},"Total entradas: "+a)),C.default.createElement("div",null,C.default.createElement("h5",{style:{fontSize:"9pt",margin:"0.2rem"}},"Total salida: "+i)))),C.default.createElement("footer",null,C.default.createElement(P,{report:this.props.report}))))}}]),t}(C.default.Component),j=function(e){function t(e){return(0,p.default)(this,t),(0,y.default)(this,(t.__proto__||(0,l.default)(t)).call(this,e))}return(0,g.default)(t,e),(0,m.default)(t,[{key:"render",value:function(){var e=[],t=0,n=0,r={textAlign:"center",padding:"0.2rem"},a={padding:"0.2rem"};for(var i in this.props.transfers){var s=this.props.transfers[i];n+=s.totalArticles,e.push(C.default.createElement("div",{key:t++},C.default.createElement("table",{style:{width:"100%"}},C.default.createElement("tbody",null,C.default.createElement("tr",null,C.default.createElement("td",null,C.default.createElement("h5",{style:{margin:"0.1rem 0"}},"Número: "+s.seq),C.default.createElement("h5",{style:{margin:"0.1rem 0"}},"Origen: "+s.originWarehouse.name+" - ["+s.originWarehouse.clientCode+"]"),C.default.createElement("h5",{style:{margin:"0.1rem 0"}},"Destino: "+s.destinationWarehouse.name+" - ["+s.destinationWarehouse.clientCode+"]"),C.default.createElement("p",{style:{margin:"0.1rem 0",fontSize:"9pt"}},"Asunto: "+s.business),C.default.createElement("p",{style:{margin:"0.1rem 0",fontSize:"9pt"}},"Descripción: "+s.description)),C.default.createElement("td",null,C.default.createElement("p",{style:{margin:"0.1rem 0",textAlign:"right",fontSize:"9pt"}},"Estado: "+s.status),C.default.createElement("p",{style:{margin:"0.1rem 0",textAlign:"right",fontSize:"9pt"}},"Fecha de creación: "+s.creationDate))))),C.default.createElement("table",{style:{width:"100%",fontSize:"9pt",borderTop:"0.1rem solid gray",borderBottom:"0.1rem solid gray"}},C.default.createElement("thead",null,C.default.createElement("tr",null,C.default.createElement("th",{style:{padding:"0.25rem"}},"No"),C.default.createElement("th",{style:{padding:"0.25rem"}},"Cod."),C.default.createElement("th",{style:{padding:"0.25rem"}},"Nombre del artículo"),C.default.createElement("th",{style:{padding:"0.25rem"}},"Observación"),C.default.createElement("th",{style:{padding:"0.25rem"}},"Cantidad"),C.default.createElement("th",{style:{padding:"0.25rem"}},"P. Unit"),C.default.createElement("th",{style:{padding:"0.25rem"}},"Total"))),C.default.createElement("tbody",null,s.articles.map(function(e,t){return C.default.createElement("tr",{key:t},C.default.createElement("td",{style:r},t),C.default.createElement("td",{style:a},e.clientCode),C.default.createElement("td",{style:a},e.name),C.default.createElement("td",{style:a},e.remark),C.default.createElement("td",{style:r},e.quantity),C.default.createElement("td",{style:r},e.unitPrice),C.default.createElement("td",{style:r},e.total))}))),C.default.createElement("h5",{style:{margin:"0.5rem 0 1rem 0"}},"Subtotal artículos: "+s.totalArticles)))}return C.default.createElement("html",null,C.default.createElement("body",null,C.default.createElement("header",null,C.default.createElement(N,{company:this.props.company,report:this.props.report})),C.default.createElement("main",null,C.default.createElement("div",{id:"pageContent",style:{zoom:"0.67",padding:"0"}},C.default.createElement("h3",{style:{textAlign:"center",fontSize:"12pt"}},"Reporte de transferencias"),C.default.createElement("h5",{style:{fontSize:"9pt",margin:"1rem 0"}},"Del "+this.props.startDate+" al "+this.props.endDate),e,C.default.createElement("h4",{style:{margin:"1rem 0 0 0"}},"Total artículos: "+n))),C.default.createElement("footer",null,C.default.createElement(P,{report:this.props.report}))))}}]),t}(C.default.Component),M=function(e){function t(e){return(0,p.default)(this,t),(0,y.default)(this,(t.__proto__||(0,l.default)(t)).call(this,e))}return(0,g.default)(t,e),(0,m.default)(t,[{key:"render",value:function(){var e={textAlign:"center",padding:"0.2rem"},t={padding:"0.2rem"};return C.default.createElement("html",null,C.default.createElement("body",null,C.default.createElement("header",null,C.default.createElement(N,{company:this.props.company,report:this.props.report})),C.default.createElement("main",null,C.default.createElement("div",{id:"pageContent",style:{zoom:"0.67",padding:"0"}},C.default.createElement("h3",{style:{textAlign:"center",fontSize:"12pt"}},"Detalle de la transferencia"),C.default.createElement("table",{style:{width:"100%"}},C.default.createElement("tbody",null,C.default.createElement("tr",null,C.default.createElement("td",null,C.default.createElement("h5",{style:{margin:"0.1rem 0"}},"Número: "+this.props.transfer.seq),C.default.createElement("h5",{style:{margin:"0.1rem 0"}},"Origen: "+this.props.transfer.originWarehouse.name+" - ["+this.props.transfer.originWarehouse.clientCode+"]"),C.default.createElement("h5",{style:{margin:"0.1rem 0"}},"Destino: "+this.props.transfer.destinationWarehouse.name+" - ["+this.props.transfer.destinationWarehouse.clientCode+"]"),C.default.createElement("p",{style:{margin:"0.1rem 0",fontSize:"9pt"}},"Asunto: "+this.props.transfer.business),C.default.createElement("p",{style:{margin:"0.1rem 0",fontSize:"9pt"}},"Descripción: "+this.props.transfer.description)),C.default.createElement("td",null,C.default.createElement("p",{style:{margin:"0.1rem 0",textAlign:"right",fontSize:"9pt"}},"Estado: "+this.props.transfer.status),C.default.createElement("p",{style:{margin:"0.1rem 0",textAlign:"right",fontSize:"9pt"}},"Fecha de creación: "+this.props.transfer.creationDate))))),C.default.createElement("table",{style:{width:"100%",fontSize:"9pt",borderTop:"0.1rem solid gray",borderBottom:"0.1rem solid gray"}},C.default.createElement("thead",null,C.default.createElement("tr",null,C.default.createElement("th",{style:{padding:"0.25rem"}},"No"),C.default.createElement("th",{style:{padding:"0.25rem"}},"Cod."),C.default.createElement("th",{style:{padding:"0.25rem"}},"Nombre del artículo"),C.default.createElement("th",{style:{padding:"0.25rem"}},"Observación"),C.default.createElement("th",{style:{padding:"0.25rem"}},"Cantidad"),C.default.createElement("th",{style:{padding:"0.25rem"}},"P. Unit"),C.default.createElement("th",{style:{padding:"0.25rem"}},"Total"))),C.default.createElement("tbody",null,this.props.transfer.articles.map(function(n,r){return C.default.createElement("tr",{key:r},C.default.createElement("td",{style:e},r),C.default.createElement("td",{style:t},n.clientCode),C.default.createElement("td",{style:t},n.name),C.default.createElement("td",{style:t},n.remark),C.default.createElement("td",{style:e},n.quantity),C.default.createElement("td",{style:e},n.unitPrice),C.default.createElement("td",{style:e},n.total))}))),C.default.createElement("h5",{style:{margin:"0.5rem 0 1rem 0"}},"Total artículos: "+this.props.transfer.totalArticles))),C.default.createElement("footer",null,C.default.createElement(P,{report:this.props.report}))))}}]),t}(C.default.Component),z=function(e){function t(e){return(0,p.default)(this,t),(0,y.default)(this,(t.__proto__||(0,l.default)(t)).call(this,e))}return(0,g.default)(t,e),(0,m.default)(t,[{key:"render",value:function(){var e=[],t=0,n=0,r=0,a={textAlign:"center",padding:"0.2rem"},i={padding:"0.2rem"};for(var s in this.props.purchases){var u=this.props.purchases[s];n+=u.totalArticles,r+=u.totalPrices,e.push(C.default.createElement("div",{key:t++},C.default.createElement("table",{style:{width:"100%"}},C.default.createElement("tbody",null,C.default.createElement("tr",null,C.default.createElement("td",null,C.default.createElement("h5",{style:{margin:"0.1rem 0"}},"Número de guía: "+u.guideNumber),C.default.createElement("p",{style:{margin:"0.1rem 0",fontSize:"9pt"}},"Proveedor: "+u.providerName),C.default.createElement("p",{style:{margin:"0.1rem 0",fontSize:"9pt"}},"Asunto: "+u.business)),C.default.createElement("td",null,C.default.createElement("p",{style:{margin:"0.1rem 0",textAlign:"right",fontSize:"9pt"}},"Estado: "+u.status),C.default.createElement("p",{style:{margin:"0.1rem 0",textAlign:"right",fontSize:"9pt"}},"Fecha de creación: "+u.creationDate))))),C.default.createElement("table",{style:{width:"100%",fontSize:"9pt",borderTop:"0.1rem solid gray",borderBottom:"0.1rem solid gray"}},C.default.createElement("thead",null,C.default.createElement("tr",null,C.default.createElement("th",{style:{padding:"0.25rem"}},"No"),C.default.createElement("th",{style:{padding:"0.25rem"}},"Cod."),C.default.createElement("th",{style:{padding:"0.25rem"}},"Nombre del artículo"),C.default.createElement("th",{style:{padding:"0.25rem"}},"Observación"),C.default.createElement("th",{style:{padding:"0.25rem"}},"Unidad"),C.default.createElement("th",{style:{padding:"0.25rem"}},"Cantidad"),C.default.createElement("th",{style:{padding:"0.25rem"}},"P. Unit"),C.default.createElement("th",{style:{padding:"0.25rem"}},"Total"))),C.default.createElement("tbody",null,u.articles.map(function(e,t){return C.default.createElement("tr",{key:t},C.default.createElement("td",{style:a},t),C.default.createElement("td",{style:i},e.clientCode),C.default.createElement("td",{style:i},e.name),C.default.createElement("td",{style:i},e.remark),C.default.createElement("td",{style:a},e.measurement),C.default.createElement("td",{style:a},e.quantity),C.default.createElement("td",{style:a},e.unitPrice),C.default.createElement("td",{style:a},e.total))}))),C.default.createElement("h5",{style:{margin:"0.5rem 0 0.2rem 0"}},"Subtotal artículos: "+u.totalArticles),C.default.createElement("h5",{style:{margin:"0.2rem 0 1rem 0"}},"Subtotal precio: "+u.totalPrices+" $")))}return C.default.createElement("html",null,C.default.createElement("body",null,C.default.createElement("header",null,C.default.createElement(N,{company:this.props.company,report:this.props.report})),C.default.createElement("main",null,C.default.createElement("div",{id:"pageContent",style:{zoom:"0.67",padding:"0"}},C.default.createElement("h3",{style:{textAlign:"center",fontSize:"12pt"}},"Reporte de compras"),C.default.createElement("h5",{style:{fontSize:"9pt",margin:"1rem 0"}},"Del "+this.props.startDate+" al "+this.props.endDate),e,C.default.createElement("h4",{style:{margin:"1.5rem 0 0 0"}},"Total artículos: "+n),C.default.createElement("h4",{style:{margin:"0.5rem 0 0 0"}},"Total precio: "+r+" $"))),C.default.createElement("footer",null,C.default.createElement(P,{report:this.props.report}))))}}]),t}(C.default.Component),B=function(e){function t(e){return(0,p.default)(this,t),(0,y.default)(this,(t.__proto__||(0,l.default)(t)).call(this,e))}return(0,g.default)(t,e),(0,m.default)(t,[{key:"render",value:function(){var e={margin:"0.1rem 0",fontSize:"9pt"},t={margin:"0.1rem 0",textAlign:"right",fontSize:"9pt"},n={textAlign:"center",padding:"0.2rem"},r={padding:"0.2rem"};return C.default.createElement("html",null,C.default.createElement("body",null,C.default.createElement("header",null,C.default.createElement(N,{company:this.props.company,report:this.props.report})),C.default.createElement("main",null,C.default.createElement("div",{id:"pageContent",style:{zoom:"0.67",padding:"0"}},C.default.createElement("h3",{style:{textAlign:"center",fontSize:"12pt"}},"Detalle de la orden de compra"),C.default.createElement("h5",{style:{margin:"0.1rem 0"}},"Información de la orden de compra"),C.default.createElement("table",{style:{width:"100%"}},C.default.createElement("tbody",null,C.default.createElement("tr",null,C.default.createElement("td",null,C.default.createElement("p",{style:e},"Número de guía: "+this.props.purchase.guideNumber),C.default.createElement("p",{style:e},"Referencia del pedido: "+this.props.purchase.order)),C.default.createElement("td",null,C.default.createElement("p",{style:t},"Asunto: "+this.props.purchase.business))))),C.default.createElement("h5",{style:{margin:"0.2rem 0"}},"Información del proveedor"),C.default.createElement("table",{style:{width:"100%"}},C.default.createElement("tbody",null,C.default.createElement("tr",null,C.default.createElement("td",null,C.default.createElement("p",{style:e},"Nombre del proveedor: "+this.props.purchase.providerName),C.default.createElement("p",{style:e},"Nombre de contacto: "+this.props.purchase.contactName)),C.default.createElement("td",null,C.default.createElement("p",{style:t},"Fecha de pago: "+this.props.purchase.payDate))))),C.default.createElement("h5",{style:{margin:"0.2rem 0"}},"Detalles de la dirección de facturación"),C.default.createElement("table",{style:{width:"100%"}},C.default.createElement("tbody",null,C.default.createElement("tr",null,C.default.createElement("td",null,C.default.createElement("p",{style:e},"Dirección de facturación: "+this.props.purchase.billingDir),C.default.createElement("p",{style:e},"País de facturación: "+this.props.purchase.billingCountry)),C.default.createElement("td",null,C.default.createElement("p",{style:t},"Departamento: "+this.props.purchase.billingDep))))),C.default.createElement("h5",{style:{margin:"0.2rem 0"}},"Detalles de la dirección de envío"),C.default.createElement("table",{style:{width:"100%"}},C.default.createElement("tbody",null,C.default.createElement("tr",null,C.default.createElement("td",null,C.default.createElement("p",{style:e},"Dirección de envío: "+this.props.purchase.shippingDir),C.default.createElement("p",{style:e},"País de envío: "+this.props.purchase.shippingCountry),C.default.createElement("p",{style:e},"Departamento: "+this.props.purchase.shippingDep)),C.default.createElement("td",null,C.default.createElement("p",{style:t},"Provincia: "+this.props.purchase.shippingProvince),C.default.createElement("p",{style:t},"Código postal: "+this.props.purchase.shippingPostal))))),C.default.createElement("h5",{style:{margin:"0.2rem 0"}},"Descripción"),C.default.createElement("p",{style:e},this.props.purchase.description),C.default.createElement("h5",{style:{margin:"0.2rem 0"}},"Términos y condiciones"),C.default.createElement("p",{style:e},this.props.purchase.terms),C.default.createElement("h5",{style:{margin:"0.2rem 0"}},"Información adicional"),C.default.createElement("p",{style:e},"Estado: "+this.props.purchase.status),C.default.createElement("p",{style:e},"Fecha de creación: "+this.props.purchase.creationDate),C.default.createElement("h5",{style:{margin:"0.2rem 0"}},"Lista de artículos"),C.default.createElement("table",{style:{width:"100%",fontSize:"9pt",borderTop:"0.1rem solid gray",borderBottom:"0.1rem solid gray"}},C.default.createElement("thead",null,C.default.createElement("tr",null,C.default.createElement("th",{style:{padding:"0.25rem"}},"No"),C.default.createElement("th",{style:{padding:"0.25rem"}},"Cod."),C.default.createElement("th",{style:{padding:"0.25rem"}},"Nombre del artículo"),C.default.createElement("th",{style:{padding:"0.25rem"}},"Observación"),C.default.createElement("th",{style:{padding:"0.25rem"}},"Unidad"),C.default.createElement("th",{style:{padding:"0.25rem"}},"Cantidad"),C.default.createElement("th",{style:{padding:"0.25rem"}},"P. Unit"),C.default.createElement("th",{style:{padding:"0.25rem"}},"Total"))),C.default.createElement("tbody",null,this.props.purchase.articles.map(function(e,t){return C.default.createElement("tr",{key:t},C.default.createElement("td",{style:n},t),C.default.createElement("td",{style:r},e.clientCode),C.default.createElement("td",{style:r},e.name),C.default.createElement("td",{style:r},e.remark),C.default.createElement("td",{style:n},e.measurement),C.default.createElement("td",{style:n},e.quantity),C.default.createElement("td",{style:n},e.unitPrice),C.default.createElement("td",{style:n},e.total))}))),C.default.createElement("h5",{style:{margin:"0.5rem 0 0.2rem 0"}},"Total artículos: "+this.props.purchase.totalArticles),C.default.createElement("h5",{style:{margin:"0.2rem 0 1rem 0"}},"Total precio: "+this.props.purchase.totalPrices+" $"))),C.default.createElement("footer",null,C.default.createElement(P,{report:this.props.report}))))}}]),t}(C.default.Component),F=function(){function e(){(0,p.default)(this,e),this.router=E.default.Router(),this.router.get("/articulos/stock/:article",this.articleStock.bind(this)),this.router.get("/almacenes/stock/:warehouse",this.warehouseStock.bind(this)),this.router.post("/transferencias/por-fecha",this.datedTransfers.bind(this)),this.router.get("/transferencias/detalle/:transfer",this.transferDetail.bind(this)),this.router.post("/compras/por-fecha",this.datedPurchases.bind(this)),this.router.get("/compras/detalle/:purchase",this.purchaseDetail.bind(this))}return(0,m.default)(e,[{key:"articleStock",value:function(e,t){var n=this;(0,k.default)(u.default.mark(function t(){var r,a,i,s,o,d,l,f,p,h,m,v,y,b,g,x,k,w,E,S,_,O,q,T,A,N,P,W,j,M,z,B,F,I,U,H,G,L,Y,V,K,J,Z,X,Q,$,ee,te,ne,re,ae,ie,se,ue,oe,ce,de,le,fe,pe,he,me,ve,ye,be,ge,xe,ke,we,Ee,Se,Ce,De;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r={},t.next=3,e.app.db.articles.findOne({code:e.params.article});case 3:return a=t.sent,t.next=6,e.app.db.warehouses.findAll("code clientCode name articles");case 6:return i=t.sent,t.next=9,e.app.db.warehouseEntryPurchases.findAll();case 9:return s=t.sent,t.next=12,e.app.db.warehouseEntryTransfers.findAll();case 12:return o=t.sent,t.next=15,e.app.db.warehouseOutletTransfers.findAll();case 15:if(d=t.sent,!i.length){t.next=249;break}l=!0,f=!1,p=void 0,t.prev=20,h=(0,c.default)(i);case 22:if(l=(m=h.next()).done){t.next=235;break}if(v=m.value,!(y=v.articles.find(function(e){return e.code===a.code}))){t.next=232;break}if(b=0,g=0,!s.length){t.next=95;break}x=!0,k=!1,w=void 0,t.prev=31,E=(0,c.default)(s);case 33:if(x=(S=E.next()).done){t.next=81;break}_=S.value,O=!0,q=!1,T=void 0,t.prev=38,A=(0,c.default)(_.transactions);case 40:if(O=(N=A.next()).done){t.next=64;break}for(P=N.value,W=!0,j=!1,M=void 0,t.prev=45,z=(0,c.default)(P.articles);!(W=(B=z.next()).done);W=!0)F=B.value,v.code===F.warehouseCode&&F.code===a.code&&(b+=F.quantity);t.next=53;break;case 49:t.prev=49,t.t0=t.catch(45),j=!0,M=t.t0;case 53:t.prev=53,t.prev=54,!W&&z.return&&z.return();case 56:if(t.prev=56,!j){t.next=59;break}throw M;case 59:return t.finish(56);case 60:return t.finish(53);case 61:O=!0,t.next=40;break;case 64:t.next=70;break;case 66:t.prev=66,t.t1=t.catch(38),q=!0,T=t.t1;case 70:t.prev=70,t.prev=71,!O&&A.return&&A.return();case 73:if(t.prev=73,!q){t.next=76;break}throw T;case 76:return t.finish(73);case 77:return t.finish(70);case 78:x=!0,t.next=33;break;case 81:t.next=87;break;case 83:t.prev=83,t.t2=t.catch(31),k=!0,w=t.t2;case 87:t.prev=87,t.prev=88,!x&&E.return&&E.return();case 90:if(t.prev=90,!k){t.next=93;break}throw w;case 93:return t.finish(90);case 94:return t.finish(87);case 95:if(!o.length){t.next=163;break}I=!0,U=!1,H=void 0,t.prev=99,G=(0,c.default)(o);case 101:if(I=(L=G.next()).done){t.next=149;break}Y=L.value,V=!0,K=!1,J=void 0,t.prev=106,Z=(0,c.default)(Y.transactions);case 108:if(V=(X=Z.next()).done){t.next=132;break}for(Q=X.value,$=!0,ee=!1,te=void 0,t.prev=113,ne=(0,c.default)(Q.articles);!($=(re=ne.next()).done);$=!0)ae=re.value,v.code===ae.warehouseCode&&ae.code===a.code&&(b+=ae.quantity);t.next=121;break;case 117:t.prev=117,t.t3=t.catch(113),ee=!0,te=t.t3;case 121:t.prev=121,t.prev=122,!$&&ne.return&&ne.return();case 124:if(t.prev=124,!ee){t.next=127;break}throw te;case 127:return t.finish(124);case 128:return t.finish(121);case 129:V=!0,t.next=108;break;case 132:t.next=138;break;case 134:t.prev=134,t.t4=t.catch(106),K=!0,J=t.t4;case 138:t.prev=138,t.prev=139,!V&&Z.return&&Z.return();case 141:if(t.prev=141,!K){t.next=144;break}throw J;case 144:return t.finish(141);case 145:return t.finish(138);case 146:I=!0,t.next=101;break;case 149:t.next=155;break;case 151:t.prev=151,t.t5=t.catch(99),U=!0,H=t.t5;case 155:t.prev=155,t.prev=156,!I&&G.return&&G.return();case 158:if(t.prev=158,!U){t.next=161;break}throw H;case 161:return t.finish(158);case 162:return t.finish(155);case 163:if(!d.length){t.next=231;break}ie=!0,se=!1,ue=void 0,t.prev=167,oe=(0,c.default)(d);case 169:if(ie=(ce=oe.next()).done){t.next=217;break}de=ce.value,le=!0,fe=!1,pe=void 0,t.prev=174,he=(0,c.default)(de.transactions);case 176:if(le=(me=he.next()).done){t.next=200;break}for(ve=me.value,ye=!0,be=!1,ge=void 0,t.prev=181,xe=(0,c.default)(ve.articles);!(ye=(ke=xe.next()).done);ye=!0)we=ke.value,v.code===we.warehouseCode&&we.code===a.code&&(g+=we.quantity);t.next=189;break;case 185:t.prev=185,t.t6=t.catch(181),be=!0,ge=t.t6;case 189:t.prev=189,t.prev=190,!ye&&xe.return&&xe.return();case 192:if(t.prev=192,!be){t.next=195;break}throw ge;case 195:return t.finish(192);case 196:return t.finish(189);case 197:le=!0,t.next=176;break;case 200:t.next=206;break;case 202:t.prev=202,t.t7=t.catch(174),fe=!0,pe=t.t7;case 206:t.prev=206,t.prev=207,!le&&he.return&&he.return();case 209:if(t.prev=209,!fe){t.next=212;break}throw pe;case 212:return t.finish(209);case 213:return t.finish(206);case 214:ie=!0,t.next=169;break;case 217:t.next=223;break;case 219:t.prev=219,t.t8=t.catch(167),se=!0,ue=t.t8;case 223:t.prev=223,t.prev=224,!ie&&oe.return&&oe.return();case 226:if(t.prev=226,!se){t.next=229;break}throw ue;case 229:return t.finish(226);case 230:return t.finish(223);case 231:r[v.code]={clientCode:v.clientCode,name:v.name,totalEntry:b,totalOutlet:g,stock:y.stock};case 232:l=!0,t.next=22;break;case 235:t.next=241;break;case 237:t.prev=237,t.t9=t.catch(20),f=!0,p=t.t9;case 241:t.prev=241,t.prev=242,!l&&h.return&&h.return();case 244:if(t.prev=244,!f){t.next=247;break}throw p;case 247:return t.finish(244);case 248:return t.finish(241);case 249:return Ee={name:e.company.name,address:"German Bush N 738",phone:"8598565",logoUrl:"http://localhost:2000/images/tabletec-logo-128x68.png"},t.next=252,e.app.db.reports.insertOne({name:"Reporte de existencias en almacenes - [Artículo: "+a.clientCode+"]"});case 252:return Se=t.sent,Ce={name:Se.name,clientCode:"RP-TT-"+Se.seq,creationDate:Se.creationDate},De=(0,D.renderToString)(C.default.createElement(R,{company:Ee,report:Ce,article:a,warehouses:r})),Se.htmlResult=De,Se.save(),t.next=259,n.buildPdfReport(De);case 259:return t.abrupt("return",t.sent);case 260:case"end":return t.stop()}},t,this,[[20,237,241,249],[31,83,87,95],[38,66,70,78],[45,49,53,61],[54,,56,60],[71,,73,77],[88,,90,94],[99,151,155,163],[106,134,138,146],[113,117,121,129],[122,,124,128],[139,,141,145],[156,,158,162],[167,219,223,231],[174,202,206,214],[181,185,189,197],[190,,192,196],[207,,209,213],[224,,226,230],[242,,244,248]])})).then(function(e){t.json({pdf:e})}).catch(function(e){t.sendError(e)})}},{key:"warehouseStock",value:function(e,t){var n=this;(0,k.default)(u.default.mark(function t(){var r,a,i,s,o,d,l,f,p,h,m,v,y,b,g,x,k,w,E,S,_,O,q,T,A,N,P,R,j,M,z,B,F,I,U,H,G,L,Y,V,K,J,Z,X,Q,$,ee,te,ne,re,ae,ie,se,ue,oe,ce,de,le,fe,pe,he,me,ve,ye,be,ge,xe,ke,we,Ee,Se,Ce,De;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.app.db.warehouses.findOne({code:e.params.warehouse});case 2:return r=t.sent,a={},t.next=6,e.app.db.warehouseEntryPurchases.findAll();case 6:return i=t.sent,t.next=9,e.app.db.warehouseEntryTransfers.findAll();case 9:if(s=t.sent,!i.length){t.next=92;break}o=!0,d=!1,l=void 0,t.prev=14,f=(0,c.default)(i);case 16:if(o=(p=f.next()).done){t.next=78;break}h=p.value,m=!0,v=!1,y=void 0,t.prev=21,b=(0,c.default)(h.transactions);case 23:if(m=(g=b.next()).done){t.next=61;break}x=g.value,k=!0,w=!1,E=void 0,t.prev=28,S=(0,c.default)(x.articles);case 30:if(k=(_=S.next()).done){t.next=44;break}if(O=_.value,O.warehouseCode!==r.code){t.next=41;break}if(void 0!==a[O.code]){t.next=40;break}return t.next=36,e.app.db.articles.findOne({code:O.code},"clientCode name");case 36:q=t.sent,a[O.code]={clientCode:q.clientCode,name:q.name,totalEntry:O.quantity,totalOutlet:0},t.next=41;break;case 40:a[O.code].totalEntry+=O.quantity;case 41:k=!0,t.next=30;break;case 44:t.next=50;break;case 46:t.prev=46,t.t0=t.catch(28),w=!0,E=t.t0;case 50:t.prev=50,t.prev=51,!k&&S.return&&S.return();case 53:if(t.prev=53,!w){t.next=56;break}throw E;case 56:return t.finish(53);case 57:return t.finish(50);case 58:m=!0,t.next=23;break;case 61:t.next=67;break;case 63:t.prev=63,t.t1=t.catch(21),v=!0,y=t.t1;case 67:t.prev=67,t.prev=68,!m&&b.return&&b.return();case 70:if(t.prev=70,!v){t.next=73;break}throw y;case 73:return t.finish(70);case 74:return t.finish(67);case 75:o=!0,t.next=16;break;case 78:t.next=84;break;case 80:t.prev=80,t.t2=t.catch(14),d=!0,l=t.t2;case 84:t.prev=84,t.prev=85,!o&&f.return&&f.return();case 87:if(t.prev=87,!d){t.next=90;break}throw l;case 90:return t.finish(87);case 91:return t.finish(84);case 92:if(!s.length){t.next=174;break}T=!0,A=!1,N=void 0,t.prev=96,P=(0,c.default)(s);case 98:if(T=(R=P.next()).done){t.next=160;break}j=R.value,M=!0,z=!1,B=void 0,t.prev=103,F=(0,c.default)(j.transactions);case 105:if(M=(I=F.next()).done){t.next=143;break}U=I.value,H=!0,G=!1,L=void 0,t.prev=110,Y=(0,c.default)(U.articles);case 112:if(H=(V=Y.next()).done){t.next=126;break}if(K=V.value,K.warehouseCode!==r.code){t.next=123;break}if(void 0!==a[K.code]){t.next=122;break}return t.next=118,e.app.db.articles.findOne({code:K.code},"clientCode name");case 118:J=t.sent,a[K.code]={clientCode:J.clientCode,name:J.name,totalEntry:K.quantity,totalOutlet:0},t.next=123;break;case 122:a[K.code].totalEntry+=K.quantity;case 123:H=!0,t.next=112;break;case 126:t.next=132;break;case 128:t.prev=128,t.t3=t.catch(110),G=!0,L=t.t3;case 132:t.prev=132,t.prev=133,!H&&Y.return&&Y.return();case 135:if(t.prev=135,!G){t.next=138;break}throw L;case 138:return t.finish(135);case 139:return t.finish(132);case 140:M=!0,t.next=105;break;case 143:t.next=149;break;case 145:t.prev=145,t.t4=t.catch(103),z=!0,B=t.t4;case 149:t.prev=149,t.prev=150,!M&&F.return&&F.return();case 152:if(t.prev=152,!z){t.next=155;break}throw B;case 155:return t.finish(152);case 156:return t.finish(149);case 157:T=!0,t.next=98;break;case 160:t.next=166;break;case 162:t.prev=162,t.t5=t.catch(96),A=!0,N=t.t5;case 166:t.prev=166,t.prev=167,!T&&P.return&&P.return();case 169:if(t.prev=169,!A){t.next=172;break}throw N;case 172:return t.finish(169);case 173:return t.finish(166);case 174:return t.next=176,e.app.db.warehouseOutletTransfers.findAll();case 176:if(Z=t.sent,!Z.length){t.next=259;break}X=!0,Q=!1,$=void 0,t.prev=181,ee=(0,c.default)(Z);case 183:if(X=(te=ee.next()).done){t.next=245;break}ne=te.value,re=!0,ae=!1,ie=void 0,t.prev=188,se=(0,c.default)(ne.transactions);case 190:if(re=(ue=se.next()).done){t.next=228;break}oe=ue.value,ce=!0,de=!1,le=void 0,t.prev=195,fe=(0,c.default)(oe.articles);case 197:if(ce=(pe=fe.next()).done){t.next=211;break}if(he=pe.value,he.warehouseCode!==r.code){t.next=208;break}if(void 0!==a[he.code]){t.next=207;break}return t.next=203,e.app.db.articles.findOne({code:he.code},"clientCode name");case 203:me=t.sent,a[he.code]={clientCode:me.clientCode,name:me.name,totalEntry:0,totalOutlet:he.quantity},t.next=208;break;case 207:a[he.code].totalOutlet+=he.quantity;case 208:ce=!0,t.next=197;break;case 211:t.next=217;break;case 213:t.prev=213,t.t6=t.catch(195),de=!0,le=t.t6;case 217:t.prev=217,t.prev=218,!ce&&fe.return&&fe.return();case 220:if(t.prev=220,!de){t.next=223;break}throw le;case 223:return t.finish(220);case 224:return t.finish(217);case 225:re=!0,t.next=190;break;case 228:t.next=234;break;case 230:t.prev=230,t.t7=t.catch(188),ae=!0,ie=t.t7;case 234:t.prev=234,t.prev=235,!re&&se.return&&se.return();case 237:if(t.prev=237,!ae){t.next=240;break}throw ie;case 240:return t.finish(237);case 241:return t.finish(234);case 242:X=!0,t.next=183;break;case 245:t.next=251;break;case 247:t.prev=247,t.t8=t.catch(181),Q=!0,$=t.t8;case 251:t.prev=251,t.prev=252,!X&&ee.return&&ee.return();case 254:if(t.prev=254,!Q){t.next=257;break}throw $;case 257:return t.finish(254);case 258:return t.finish(251);case 259:ve=!0,ye=!1,be=void 0,t.prev=262,ge=(0,c.default)(r.articles);case 264:if(ve=(xe=ge.next()).done){t.next=277;break}if(ke=xe.value,void 0!==a[ke.code]){t.next=273;break}return t.next=269,e.app.db.articles.findOne({code:ke.code},"clientCode name");case 269:we=t.sent,a[ke.code]={clientCode:we.clientCode,name:we.name,totalEntry:0,totalOutlet:0,stock:ke.stock},t.next=274;break;case 273:a[ke.code].stock=ke.stock;case 274:ve=!0,t.next=264;break;case 277:t.next=283;break;case 279:t.prev=279,t.t9=t.catch(262),ye=!0,be=t.t9;case 283:t.prev=283,t.prev=284,!ve&&ge.return&&ge.return();case 286:if(t.prev=286,!ye){t.next=289;break}throw be;case 289:return t.finish(286);case 290:return t.finish(283);case 291:return Ee={name:e.company.name,address:"German Bush N 738",phone:"8598565",logoUrl:"http://localhost:2000/images/tabletec-logo-128x68.png"},t.next=294,e.app.db.reports.insertOne({name:"Reporte de existencias en almacén - ["+r.clientCode+"]"});case 294:return Se=t.sent,Ce={name:Se.name,clientCode:"RP-TT-"+Se.seq,creationDate:Se.creationDate},De=(0,D.renderToString)(C.default.createElement(W,{company:Ee,report:Ce,warehouse:r,articles:a})),Se.htmlResult=De,Se.save(),t.next=301,n.buildPdfReport(De);case 301:return t.abrupt("return",t.sent);case 302:case"end":return t.stop()}},t,this,[[14,80,84,92],[21,63,67,75],[28,46,50,58],[51,,53,57],[68,,70,74],[85,,87,91],[96,162,166,174],[103,145,149,157],[110,128,132,140],[133,,135,139],[150,,152,156],[167,,169,173],[181,247,251,259],[188,230,234,242],[195,213,217,225],[218,,220,224],[235,,237,241],[252,,254,258],[262,279,283,291],[284,,286,290]])})).then(function(e){t.json({pdf:e})}).catch(function(e){t.sendError(e)})}},{key:"datedTransfers",value:function(e,t){var n=this;(0,k.default)(u.default.mark(function t(){var r,a,i,s,o,d,l,f,p,h,m,v,y,b,g,x,k,w,E,S,_,O,q,T;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=A.default.parse(e.body.startDate),a=A.default.parse(e.body.endDate),!(r>a)){t.next=4;break}throw"No permitido: la fecha de inicio debe ser menor a la fecha fin.";case 4:return i={},t.next=7,e.app.db.transfers.findAllPlane("code seq business status description articles originWarehouseCode destinationWarehouseCode creationDate");case 7:if(s=t.sent,!s.length){t.next=71;break}o=!0,d=!1,l=void 0,t.prev=12,f=(0,c.default)(s);case 14:if(o=(p=f.next()).done){t.next=57;break}if(h=p.value,!((m=A.default.parse(h.creationDate.split(" ")[0]))>=r&&m<=a)){t.next=54;break}return t.next=20,e.app.db.warehouses.findOne({code:h.originWarehouseCode},"clientCode name");case 20:return v=t.sent,t.next=23,e.app.db.warehouses.findOne({code:h.destinationWarehouseCode},"clientCode name");case 23:y=t.sent,i[h.code]={seq:h.seq,originWarehouse:{clientCode:v.clientCode,name:v.name},destinationWarehouse:{clientCode:y.clientCode,name:y.name},business:h.business,description:h.description,status:n.translateTransferStatus(h.status),creationDate:h.creationDate,articles:[],totalArticles:0},b=!0,g=!1,x=void 0,t.prev=28,k=(0,c.default)(h.articles);case 30:if(b=(w=k.next()).done){t.next=40;break}return E=w.value,t.next=34,e.app.db.articles.findOne({code:E.code},"clientCode name");case 34:S=t.sent,i[h.code].articles.push({clientCode:S.clientCode,name:S.name,quantity:E.quantity,unitPrice:E.unitPrice,total:E.quantity*E.unitPrice,remark:E.remark}),i[h.code].totalArticles+=E.quantity;case 37:b=!0,t.next=30;break;case 40:t.next=46;break;case 42:t.prev=42,t.t0=t.catch(28),g=!0,x=t.t0;case 46:t.prev=46,t.prev=47,!b&&k.return&&k.return();case 49:if(t.prev=49,!g){t.next=52;break}throw x;case 52:return t.finish(49);case 53:return t.finish(46);case 54:o=!0,t.next=14;break;case 57:t.next=63;break;case 59:t.prev=59,t.t1=t.catch(12),d=!0,l=t.t1;case 63:t.prev=63,t.prev=64,!o&&f.return&&f.return();case 66:if(t.prev=66,!d){t.next=69;break}throw l;case 69:return t.finish(66);case 70:return t.finish(63);case 71:return _={name:e.company.name,address:"German Bush N 738",phone:"8598565",logoUrl:"http://localhost:2000/images/tabletec-logo-128x68.png"},t.next=74,e.app.db.reports.insertOne({name:"Reporte de transferencias - [Del "+e.body.startDate+" al "+e.body.endDate+"]"});case 74:return O=t.sent,q={name:O.name,clientCode:"RP-TT-"+O.seq,creationDate:O.creationDate},T=(0,D.renderToString)(C.default.createElement(j,{company:_,report:q,transfers:i,startDate:e.body.startDate,endDate:e.body.endDate})),O.htmlResult=T,O.save(),t.next=81,n.buildPdfReport(T);case 81:return t.abrupt("return",t.sent);case 82:case"end":return t.stop()}},t,this,[[12,59,63,71],[28,42,46,54],[47,,49,53],[64,,66,70]])})).then(function(e){t.json({pdf:e})}).catch(function(e){t.sendError(e)})}},{key:"transferDetail",value:function(e,t){var n=this;(0,k.default)(u.default.mark(function t(){var r,a,i,s,o,d,l,f,p,h,m,v,y,b,g;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r={},t.next=3,e.app.db.transfers.findOne({code:e.params.transfer});case 3:if(!(a=t.sent)){t.next=43;break}return t.next=7,e.app.db.warehouses.findOne({code:a.originWarehouseCode},"clientCode name");case 7:return i=t.sent,t.next=10,e.app.db.warehouses.findOne({code:a.destinationWarehouseCode},"clientCode name");case 10:s=t.sent,r={seq:a.seq,originWarehouse:{clientCode:i.clientCode,name:i.name},destinationWarehouse:{clientCode:s.clientCode,name:s.name},business:a.business,description:a.description,status:n.translateTransferStatus(a.status),creationDate:a.creationDate,articles:[],totalArticles:0},o=!0,d=!1,l=void 0,t.prev=15,f=(0,c.default)(a.articles);case 17:if(o=(p=f.next()).done){t.next=27;break}return h=p.value,t.next=21,e.app.db.articles.findOne({code:h.code},"clientCode name");case 21:m=t.sent,r.articles.push({clientCode:m.clientCode,name:m.name,quantity:h.quantity,unitPrice:h.unitPrice,total:h.quantity*h.unitPrice,remark:h.remark}),r.totalArticles+=h.quantity;case 24:o=!0,t.next=17;break;case 27:t.next=33;break;case 29:t.prev=29,t.t0=t.catch(15),d=!0,l=t.t0;case 33:t.prev=33,t.prev=34,!o&&f.return&&f.return();case 36:if(t.prev=36,!d){t.next=39;break}throw l;case 39:return t.finish(36);case 40:return t.finish(33);case 41:t.next=44;break;case 43:throw"No se encontró la transferencia";case 44:return v={name:e.company.name,address:"German Bush N 738",phone:"8598565",logoUrl:"http://localhost:2000/images/tabletec-logo-128x68.png"},t.next=47,e.app.db.reports.insertOne({name:"Reporte de transferencia - ["+r.seq+"]"});case 47:return y=t.sent,b={name:y.name,clientCode:"RP-TT-"+y.seq,creationDate:y.creationDate},g=(0,D.renderToString)(C.default.createElement(M,{company:v,report:b,transfer:r})),y.htmlResult=g,y.save(),t.next=54,n.buildPdfReport(g);case 54:return t.abrupt("return",t.sent);case 55:case"end":return t.stop()}},t,this,[[15,29,33,41],[34,,36,40]])})).then(function(e){t.json({pdf:e})}).catch(function(e){t.sendError(e)})}},{key:"datedPurchases",value:function(e,t){var n=this;(0,k.default)(u.default.mark(function t(){var r,a,i,s,o,d,l,f,p,h,m,v,y,b,g,x,k,w,E,S,_,O,q,T;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=A.default.parse(e.body.startDate),a=A.default.parse(e.body.endDate),!(r>a)){t.next=4;break}throw"No permitido: la fecha de inicio debe ser menor a la fecha fin.";case 4:return i={},t.next=7,e.app.db.purchases.find({},"code business guideNumber status providerCode description articles creationDate");case 7:if(s=t.sent,!s.length){t.next=70;break}o=!0,d=!1,l=void 0,t.prev=12,f=(0,c.default)(s);case 14:if(o=(p=f.next()).done){t.next=56;break}if(h=p.value,!((m=A.default.parse(h.creationDate.split(" ")[0]))>=r&&m<=a)){t.next=53;break}return t.next=20,e.app.db.providers.findOne({code:h.providerCode},"name");case 20:v=t.sent,i[h.code]={guideNumber:h.guideNumber,business:h.business,description:h.description,status:n.translatePurchaseStatus(h.status),creationDate:h.creationDate,providerName:v.name,articles:[],totalArticles:0,totalPrices:0},y=!0,b=!1,g=void 0,t.prev=25,x=(0,c.default)(h.articles);case 27:if(y=(k=x.next()).done){t.next=39;break}return w=k.value,t.next=31,e.app.db.articles.findOne({code:w.code},"clientCode name");case 31:E=t.sent,S=w.quantity*w.unitPrice,i[h.code].articles.push({clientCode:E.clientCode,name:E.name,measurement:w.measurement,quantity:w.quantity,unitPrice:w.unitPrice,total:S,remark:w.remark}),i[h.code].totalArticles+=w.quantity,i[h.code].totalPrices+=S;case 36:y=!0,t.next=27;break;case 39:t.next=45;break;case 41:t.prev=41,t.t0=t.catch(25),b=!0,g=t.t0;case 45:t.prev=45,t.prev=46,!y&&x.return&&x.return();case 48:if(t.prev=48,!b){t.next=51;break}throw g;case 51:return t.finish(48);case 52:return t.finish(45);case 53:o=!0,t.next=14;break;case 56:t.next=62;break;case 58:t.prev=58,t.t1=t.catch(12),d=!0,l=t.t1;case 62:t.prev=62,t.prev=63,!o&&f.return&&f.return();case 65:if(t.prev=65,!d){t.next=68;break}throw l;case 68:return t.finish(65);case 69:return t.finish(62);case 70:return _={name:e.company.name,address:"German Bush N 738",phone:"8598565",logoUrl:"http://localhost:2000/images/tabletec-logo-128x68.png"},t.next=73,e.app.db.reports.insertOne({name:"Reporte de compras - [Del "+e.body.startDate+" al "+e.body.endDate+"]"});case 73:return O=t.sent,q={name:O.name,clientCode:"RP-TT-"+O.seq,creationDate:O.creationDate},T=(0,D.renderToString)(C.default.createElement(z,{company:_,report:q,purchases:i,startDate:e.body.startDate,endDate:e.body.endDate})),O.htmlResult=T,O.save(),t.next=80,n.buildPdfReport(T);case 80:return t.abrupt("return",t.sent);case 81:case"end":return t.stop()}},t,this,[[12,58,62,70],[25,41,45,53],[46,,48,52],[63,,65,69]])})).then(function(e){t.json({pdf:e})}).catch(function(e){t.sendError(e)})}},{key:"purchaseDetail",value:function(e,t){var n=this;(0,k.default)(u.default.mark(function t(){var r,a,i,s,o,d,l,f,p,h,m,v,y,b,g;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r={},t.next=3,e.app.db.purchases.findOne({code:e.params.purchase});case 3:if(!(a=t.sent)){t.next=42;break}return t.next=7,e.app.db.providers.findOne({code:a.providerCode},"name");case 7:i=t.sent,r={guideNumber:a.guideNumber,business:a.business,order:a.order,providerName:i.name,contactName:a.contactName,payDate:a.payDate,billingDir:a.billingDir,billingCountry:a.billingCountry,billingDep:a.billingDep,shippingDir:a.shippingDir,shippingCountry:a.shippingCountry,shippingDep:a.shippingDep,shippingProvince:a.shippingProvince,shippingPostal:a.shippingPostal,terms:a.terms,description:a.description,status:n.translatePurchaseStatus(a.status),creationDate:a.creationDate,articles:[],totalArticles:0,totalPrices:0},s=!0,o=!1,d=void 0,t.prev=12,l=(0,c.default)(a.articles);case 14:if(s=(f=l.next()).done){t.next=26;break}return p=f.value,t.next=18,e.app.db.articles.findOne({code:p.code},"clientCode name");case 18:h=t.sent,m=p.quantity*p.unitPrice,r.articles.push({clientCode:h.clientCode,name:h.name,measurement:p.measurement,quantity:p.quantity,unitPrice:p.unitPrice,total:m,remark:p.remark}),r.totalArticles+=p.quantity,r.totalPrices+=m;case 23:s=!0,t.next=14;break;case 26:t.next=32;break;case 28:t.prev=28,t.t0=t.catch(12),o=!0,d=t.t0;case 32:t.prev=32,t.prev=33,!s&&l.return&&l.return();case 35:if(t.prev=35,!o){t.next=38;break}throw d;case 38:return t.finish(35);case 39:return t.finish(32);case 40:t.next=43;break;case 42:throw"No se encontró la orden de compra";case 43:return v={name:e.company.name,address:"German Bush N 738",phone:"8598565",logoUrl:"http://localhost:2000/images/tabletec-logo-128x68.png"},t.next=46,e.app.db.reports.insertOne({name:"Reporte de compra - ["+r.guideNumber+"]"});case 46:return y=t.sent,b={name:y.name,clientCode:"RP-TT-"+y.seq,creationDate:y.creationDate},g=(0,D.renderToString)(C.default.createElement(B,{company:v,report:b,purchase:r})),y.htmlResult=g,y.save(),t.next=53,n.buildPdfReport(g);case 53:return t.abrupt("return",t.sent);case 54:case"end":return t.stop()}},t,this,[[12,28,32,40],[33,,35,39]])})).then(function(e){t.json({pdf:e})}).catch(function(e){t.sendError(e)})}},{key:"buildPdfReport",value:function(e){return new i.default(function(t,n){var r={type:"pdf",format:"Letter",border:{top:"10mm",right:"10mm",bottom:"10mm",left:"10mm"},header:{height:"24mm"},footer:{height:"10mm"}};O.default.create(e,r).toBuffer(function(e,r){e?n("Failed to convert to pdf:"):Buffer.isBuffer(r)?t(r.toString("base64")):n("This is a buffer:",Buffer.isBuffer(r))})})}},{key:"translateTransferStatus",value:function(e){switch(e){case"created":return"Creado";case"approved":return"Aprobado";case"cancelled":return"Cancelado";case"withdrawn":return"Retirado del almacen de origen";case"delayed":return"Retrasado";case"joined":return"Depositado en almacén destino";default:return"Desconocido"}}},{key:"translatePurchaseStatus",value:function(e){switch(e){case"created":return"Creado";case"approved":return"Aprobado";case"cancelled":return"Cancelado";case"delivered":return"Entregado";case"delayed":return"Retrasado";case"joined":return"Depositado en almacén";default:return"Desconocido"}}}]),e}();e.exports=F},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(5),i=r(a),s=n(0),u=r(s),o=n(1),c=r(o),d=n(6),l=r(d),f=n(12),p=r(f),h=n(13),m=(r(h),function(){function e(){(0,u.default)(this,e),this.router=p.default.Router(),this.router.get("/listar",this.findAll.bind(this)),this.router.get("/ver/:transfer",this.findOne_GET.bind(this)),this.router.post("/insertar",this.insertOnePOST.bind(this)),this.router.put("/cambiar-estado",this.updateOneStatusPUT.bind(this)),this.router.get("/listar-aprobados",this.findAllApprovedGET.bind(this)),this.router.get("/listar-retirados",this.findAllWithdrawnGET.bind(this)),this.router.get("/ver-articulos/:transfer",this.findOneArticlesGET.bind(this))}return(0,c.default)(e,[{key:"findAll",value:function(e,t){e.app.db.transfers.findAll().then(function(n){var r=n.map(function(e){return{code:e.code,seq:e.seq,business:e.business,status:e.status,originWarehouseName:e.originWarehouseName,destinationWarehouseName:e.destinationWarehouseName,description:e.description,creationDate:e.creationDate,modifiedDate:e.modifiedDate}});t.status(200).json({transfers:{columns:e.app.db.transfers.getSchemaColumns(),rows:r}})}).catch(function(e){t.sendError(e)})}},{key:"findOne_GET",value:function(e,t){e.app.db.transfers.findOne({code:e.params.transfer}).then(function(e){t.status(200).json({transfer:{code:e.code,seq:e.seq,business:e.business,status:e.status,originWarehouse:e.originWarehouse,destinationWarehouse:e.destinationWarehouse,description:e.description,articles:e.modArticles,creationDate:e.creationDate,modifiedDate:e.modifiedDate}})}).catch(function(e){t.sendError(e)})}},{key:"findAllApprovedGET",value:function(e,t){e.app.db.transfers.find({status:"approved"}).then(function(n){var r=n.map(function(e){return{code:e.code,business:e.business,status:e.status,originWarehouseCode:e.originWarehouseCode,originWarehouseName:e.originWarehouseName,destinationWarehouseCode:e.destinationWarehouseCode,destinationWarehouseName:e.destinationWarehouseName,description:e.description,creationDate:e.creationDate,modifiedDate:e.modifiedDate}});t.status(200).json({transfers:{columns:e.app.db.transfers.getSchemaColumns(),rows:r}})}).catch(function(e){t.sendError(e)})}},{key:"findAllWithdrawnGET",value:function(e,t){e.app.db.transfers.find({status:"withdrawn"}).then(function(n){var r=n.map(function(e){return{code:e.code,business:e.business,status:e.status,originWarehouseCode:e.originWarehouseCode,originWarehouseName:e.originWarehouseName,destinationWarehouseCode:e.destinationWarehouseCode,destinationWarehouseName:e.destinationWarehouseName,description:e.description,creationDate:e.creationDate,modifiedDate:e.modifiedDate}});t.status(200).json({transfers:{columns:e.app.db.transfers.getSchemaColumns(),rows:r}})}).catch(function(e){t.sendError(e)})}},{key:"findOneArticlesGET",value:function(e,t){e.app.db.transfers.findOne({code:e.params.transfer}).then(function(e){t.status(200).json({transferArticles:e.modArticles})}).catch(function(e){t.sendError(e)})}},{key:"insertOnePOST",value:function(e,t){(0,l.default)(i.default.mark(function t(){return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.app.db.transfers.insertOne(e.body);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)})).then(function(e){t.json({transfer:e})}).catch(function(e){t.sendError(e)})}},{key:"updateOneStatusPUT",value:function(e,t){(0,l.default)(i.default.mark(function t(){return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.app.db.transfers.updateOneStatus(e.body);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)})).then(function(e){t.json({transfer:e})}).catch(function(e){t.sendError(e)})}}]),e}());e.exports=m},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(5),i=r(a),s=n(0),u=r(s),o=n(1),c=r(o),d=n(6),l=r(d),f=n(12),p=r(f),h=n(13),m=(r(h),function(){function e(){(0,u.default)(this,e),this.router=p.default.Router(),this.router.get("/listar",this.findAll.bind(this)),this.router.get("/ver/:entry",this.findOne.bind(this)),this.router.post("/insertar",this.insertOnePOST.bind(this))}return(0,c.default)(e,[{key:"findAll",value:function(e,t){e.app.db.warehouseEntries.findAll().then(function(n){var r=n.map(function(e){return{code:e.code,transactionsTypeName:e.transactionsTypeName,description:e.description,entryDate:e.entryDate,creationDate:e.creationDate,modifiedDate:e.modifiedDate}});t.status(200).json({entries:{columns:e.app.db.warehouseEntries.getSchemaColumns(),rows:r}})}).catch(function(e){t.sendError(e)})}},{key:"findOne",value:function(e,t){(0,l.default)(i.default.mark(function t(){var n,r;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.app.db.warehouseEntries.findOne({code:e.params.entry});case 2:n=t.sent,r=void 0,t.t0=n.transactionsTypeName,t.next="purchases"===t.t0?7:"transfers"===t.t0?11:15;break;case 7:return t.next=9,e.app.db.warehouseEntryPurchases.findOne({code:e.params.entry});case 9:return r=t.sent,t.abrupt("break",16);case 11:return t.next=13,e.app.db.warehouseEntryTransfers.findOne({code:e.params.entry});case 13:return r=t.sent,t.abrupt("break",16);case 15:throw"No se reconoce el tipo de transacción";case 16:return t.abrupt("return",{code:r.code,transactionsTypeName:n.transactionsTypeName,description:n.description,entryDate:n.entryDate,transactions:r.modTransactions,creationDate:r.creationDate,modifiedDate:r.modifiedDate});case 17:case"end":return t.stop()}},t,this)})).then(function(e){t.json({entry:e})}).catch(function(e){t.sendError(e)})}},{key:"insertOnePOST",value:function(e,t){(0,l.default)(i.default.mark(function t(){return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=e.body.transactionsTypeName,t.next="purchases"===t.t0?3:"transfers"===t.t0?6:"custom"===t.t0?9:10;break;case 3:return t.next=5,e.app.db.warehouseEntryPurchases.insertOne(e.body);case 5:return t.abrupt("return",t.sent);case 6:return t.next=8,e.app.db.warehouseEntryTransfers.insertOne(e.body);case 8:return t.abrupt("return",t.sent);case 9:return t.abrupt("break",11);case 10:throw"No se reconoce el tipo de transacción";case 11:case"end":return t.stop()}},t,this)})).then(function(e){t.json(e)}).catch(function(e){t.sendError(e)})}}]),e}());e.exports=m},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(5),i=r(a),s=n(0),u=r(s),o=n(1),c=r(o),d=n(6),l=r(d),f=n(12),p=r(f),h=n(13),m=(r(h),function(){function e(){(0,u.default)(this,e),this.router=p.default.Router(),this.router.get("/listar",this.findAll.bind(this)),this.router.get("/ver/:outlet",this.findOne.bind(this)),this.router.post("/insertar",this.insertOnePOST.bind(this))}return(0,c.default)(e,[{key:"findAll",value:function(e,t){e.app.db.warehouseOutlets.findAll().then(function(n){var r=n.map(function(e){return{code:e.code,transactionsTypeName:e.transactionsTypeName,description:e.description,outletDate:e.outletDate,creationDate:e.creationDate,modifiedDate:e.modifiedDate}});t.status(200).json({outlets:{columns:e.app.db.warehouseOutlets.getSchemaColumns(),rows:r}})}).catch(function(e){t.sendError(e)})}},{key:"findOne",value:function(e,t){(0,l.default)(i.default.mark(function t(){var n,r;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.app.db.warehouseOutlets.findOne({code:e.params.outlet});case 2:n=t.sent,t.t0=n.transactionsTypeName,t.next="transfers"===t.t0?6:10;break;case 6:return t.next=8,e.app.db.warehouseOutletTransfers.findOne({code:e.params.outlet});case 8:return r=t.sent,t.abrupt("return",{code:r.code,transactionsTypeName:n.transactionsTypeName,description:n.description,outletDate:n.outletDate,transactions:r.modTransactions,creationDate:r.creationDate,modifiedDate:r.modifiedDate});case 10:throw"No se reconoce el tipo de transacción en salida de almacén";case 11:case"end":return t.stop()}},t,this)})).then(function(e){t.json({outlet:e})}).catch(function(e){t.sendError(e)})}},{key:"insertOnePOST",value:function(e,t){(0,l.default)(i.default.mark(function t(){return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=e.body.transactionsTypeName,t.next="transfers"===t.t0?3:"custom"===t.t0?7:8;break;case 3:return t.next=5,e.app.db.warehouseOutletTransfers.insertOne(e.body);case 5:return t.abrupt("return",t.sent);case 7:return t.abrupt("break",9);case 8:throw"No se reconoce el tipo de transacción";case 9:case"end":return t.stop()}},t,this)})).then(function(e){t.json(e)}).catch(function(e){t.sendError(e)})}}]),e}());e.exports=m},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(5),i=r(a),s=n(0),u=r(s),o=n(1),c=r(o),d=n(6),l=r(d),f=n(12),p=r(f),h=n(13),m=(r(h),function(){function e(){(0,u.default)(this,e),this.router=p.default.Router(),this.router.get("/listar",this.findAll.bind(this)),this.router.get("/listar-ciudades",this.findAllCities.bind(this)),this.router.get("/ver/:warehouse",this.findOne.bind(this)),this.router.post("/insertar",this.insertOne_POST.bind(this)),this.router.put("/editar",this.updateOne_PUT.bind(this)),this.router.get("/ver-articulos/:warehouse",this.findAllArticlesFor_GET.bind(this))}return(0,c.default)(e,[{key:"findAll",value:function(e,t){e.app.db.warehouses.findAll().then(function(n){t.status(200).json({warehouses:{columns:e.app.db.warehouses.getSchemaColumns(),rows:n}})}).catch(function(e){t.sendError(e)})}},{key:"findOne",value:function(e,t){e.app.db.warehouses.findOne({code:e.params.warehouse}).then(function(e){t.status(200).json({warehouse:e})}).catch(function(e){t.sendError(e)})}},{key:"findAllArticlesFor_GET",value:function(e,t){(0,l.default)(i.default.mark(function t(){var n;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.app.db.warehouses.findOne({code:e.params.warehouse},"code name articles");case 2:return n=t.sent,t.next=5,n.findAllStockOn(e.app.db.articles);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}},t,this)})).then(function(e){t.json({articles:{rows:e}})}).catch(function(e){t.sendError(e)})}},{key:"findAllCities",value:function(e,t){e.app.db.cities.findAll().then(function(e){t.status(200).json({cities:e})}).catch(function(e){t.sendError(e)})}},{key:"insertOne_POST",value:function(e,t){(0,l.default)(i.default.mark(function t(){return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.app.db.warehouses.insertOne(e.body);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)})).then(function(e){t.json({warehouse:e})}).catch(function(e){t.sendError(e)})}},{key:"updateOne_PUT",value:function(e,t){(0,l.default)(i.default.mark(function t(){return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.app.db.warehouses.updateOne({code:e.body.code},{clientCode:e.body.clientCode,name:e.body.name,type:e.body.type,country:e.body.country,city:e.body.city,address:e.body.address,phone:e.body.phone,postcode:e.body.postcode});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)})).then(function(e){t.json(e)}).catch(function(e){t.sendError(e)})}}]),e}());e.exports=m},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(16),i=r(a),s=n(5),u=r(s),o=n(0),c=r(o),d=n(1),l=r(d),f=n(12),p=r(f),h=n(13),m=r(h),v=n(6),y=r(v),b=function(){function e(){(0,c.default)(this,e),this.router=p.default.Router(),this.router.post("/iniciar",this.loginPOST.bind(this)),this.router.get("/autenticar",m.default.authenticate("jwt",{session:!1}),this.authenticateGET.bind(this)),this.router.post("/iniciar-con-empresa",this.loginWithCompanyPOST.bind(this)),this.router.get("/empresas",m.default.authenticate("jwt",{session:!1}),this.companiesGET.bind(this))}return(0,l.default)(e,[{key:"authenticateGET",value:function(e,t){(0,y.default)(u.default.mark(function t(){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",{user:{code:e.user.code,name:e.user.name,email:e.user.email}});case 1:case"end":return t.stop()}},t,this)})).then(function(e){t.json(e)}).catch(function(e){t.sendError(e)})}},{key:"loginPOST",value:function(e,t){(0,y.default)(u.default.mark(function t(){var n,r;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.app.systemdb.users.findOneByEmail(e.body);case 2:return n=t.sent,t.next=5,n.auth({password:e.body.password});case 5:return t.next=7,e.app.auth.sign({code:n.code,name:n.name});case 7:return r=t.sent,t.abrupt("return",{token:r});case 9:case"end":return t.stop()}},t,this)})).then(function(e){t.json(e)}).catch(function(e){t.sendError(e)})}},{key:"loginWithCompanyPOST",value:function(e,t){(0,y.default)(u.default.mark(function t(){var n,r,a,i,s,o;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.body.company){t.next=2;break}throw"No existe nombre de empresa.";case 2:return console.log("BODY",e.body.company),t.next=5,e.app.systemdb.companies.findOne({uniqueName:e.body.company});case 5:return n=t.sent,console.log("DB COMPANY",n),t.next=9,e.app.dbConnection(n.sysname);case 9:if(r=t.sent,"active"===n.status){t.next=12;break}throw n.name+" esta "+n.status;case 12:return t.next=14,e.app.systemdb.users.findOneByEmail(e.body);case 14:return a=t.sent,t.next=17,a.auth({password:e.body.password});case 17:return console.log("DB USER",a),i=a.companies.find(function(e){return n.code===e.code}),t.next=21,r.staff.findOne({code:a.code});case 21:if(s=t.sent,i&&s){t.next=24;break}throw"Acceso no autorizado";case 24:return console.log("DB EMPLOYE",s),t.next=27,e.app.auth.sign({code:a.code,name:a.name});case 27:return o=t.sent,console.log("TOKEN",o),t.abrupt("return",{token:o});case 30:case"end":return t.stop()}},t,this)})).then(function(e){t.json(e)}).catch(function(e){t.sendError(e)})}},{key:"companiesGET",value:function(e,t){(0,y.default)(u.default.mark(function t(){var n,r,a,s,o,c,d,l;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=[],r=!0,a=!1,s=void 0,t.prev=4,o=(0,i.default)(e.user.companies);case 6:if(r=(c=o.next()).done){t.next=15;break}return d=c.value,t.next=10,e.app.systemdb.companies.findOne({code:d.code});case 10:l=t.sent,n.push({name:l.name,uniqueName:l.uniqueName});case 12:r=!0,t.next=6;break;case 15:t.next=21;break;case 17:t.prev=17,t.t0=t.catch(4),a=!0,s=t.t0;case 21:t.prev=21,t.prev=22,!r&&o.return&&o.return();case 24:if(t.prev=24,!a){t.next=27;break}throw s;case 27:return t.finish(24);case 28:return t.finish(21);case 29:return t.abrupt("return",{companies:n});case 30:case"end":return t.stop()}},t,this,[[4,17,21,29],[22,,24,28]])})).then(function(e){console.log(e),t.json(e)}).catch(function(e){t.sendError(e)})}}]),e}();e.exports=b},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(0),i=r(a),s=n(1),u=r(s),o=n(12),c=r(o),d=function(){function e(){(0,i.default)(this,e),this.router=c.default.Router(),this.router.get("/recaptcha-clave-publica",this.recaptchaPublicKeyGET.bind(this))}return(0,u.default)(e,[{key:"recaptchaPublicKeyGET",value:function(e,t){t.json({rpk:e.app.defs.STR_RECAPTCHA_PUBLIC_KEY})}}]),e}();e.exports=d},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(11),i=r(a),s=n(5),u=r(s),o=n(0),c=r(o),d=n(1),l=r(d),f=n(12),p=r(f),h=n(6),m=r(h),v=n(17),y=r(v),b=n(24),g=r(b),x=n(20),k=(r(x),n(19)),w=r(k),E=n(21),S=r(E),C=function(){function e(){(0,c.default)(this,e)}return(0,l.default)(e,null,[{key:"process",value:function(t,n,r){(0,m.default)(u.default.mark(function r(){return u.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.hashed(t,n);case 2:return r.next=4,e.sigupPosted(t,n);case 4:return r.next=6,e.sigupVerified(t,n);case 6:return r.next=8,e.sigupFinished(t,n);case 8:return r.next=10,e.loged(t,n);case 10:return r.abrupt("return",{});case 11:case"end":return r.stop()}},r,this)})).then(function(e){r()}).catch(function(e){r()})}},{key:"hashed",value:function(e,t){return new i.default(function(t,n){if(e.params.accountHash){var r=e.params.accountHash.split("-");if(4===r.length&&8===r[0].length&&4===r[1].length&&4===r[2].length&&8===r[3].length)e.account={status:"hashed",hash:e.params.accountHash,statusMessages:["El codigo hash del usuario a sido validado"]},t();else{var a="El codigo hash del usuario no pudo ser validado";e.account={status:"error",hash:e.params.accountHash,statusMessages:[a]},n(a)}}else{var i="No se ha proporcionado un codigo hash para el usuario";e.account={status:"error",hash:"",statusMessages:[i]},n(i)}})}},{key:"sigupPosted",value:function(e,t){return new i.default(function(t,n){"hashed"===e.account.status?e.app.db.users.findOne({hashCode:e.params.accountHash}).then(function(n){n&&(e.account.user=n,e.account.user.currentEmail=e.account.user.emails.find(function(e){return e.current}),e.account.status="sigup-posted",e.account.statusMessages.push(" EL usuario "+e.params.accountHash+" ya está registrado")),t()}).catch(function(e){n(e)}):n()})}},{key:"sigupVerified",value:function(e,t){return new i.default(function(t,n){"sigup-posted"===e.account.status?(e.account.user.currentEmail.verified&&(e.account.status="sigup-verified",e.account.statusMessages.push(" EL usuario "+e.params.accountHash+" ya ha sido verificado")),t()):n()})}},{key:"sigupFinished",value:function(e,t){return new i.default(function(t,n){"sigup-verified"===e.account.status?("undefined"!==e.account.user.role&&(e.account.status="sigup-finished",e.account.statusMessages.push(" EL usuario "+e.params.accountHash+" ya está registrado")),t()):n()})}},{key:"loged",value:function(e,t){return new i.default(function(t,n){e.app.auth.authorize(e,function(r,a){r?n():a?(e.account.status="loged-in",e.account.statusMessages.push(" EL usuario "+e.params.accountHash+" ha iniciado sesión"),t()):(e.account.status="loged-out",e.account.statusMessages.push(" EL usuario "+e.params.accountHash+" no ha iniciado sesión"))})})}}]),e}(),D=function(){function e(){(0,c.default)(this,e),this.router=p.default.Router(),this.router.get("/",this.welcome.bind(this)),this.router.get("/crear-cuenta/:accountHash?",C.process,this.createAccount.bind(this)),this.router.get("/verificar/:accountHash?",C.process,this.verifyAccount.bind(this)),this.router.get("/verificar-email/:accountHash/:emailHash",C.process,this.verifyAccountEmail.bind(this)),this.router.get("/finalizar/:accountHash",C.process,this.finish.bind(this)),this.router.get("/api/estado-cuenta/:accountHash?",C.process,this.statusAccountGET.bind(this)),this.router.get("/api/email/:accountHash?",C.process,this.signupEmailGET.bind(this)),this.router.post("/api/crear-cuenta/:accountHash?",g.default.verifyCaptchaMW,C.process,this.createAccountPOST.bind(this)),this.router.post("/api/crear-clave/:accountHash?",C.process,this.createAccountPasswordPOST.bind(this))}return(0,l.default)(e,[{key:"welcome",value:function(e,t){t.send(S.default.view("signup"))}},{key:"createAccount",value:function(e,t){switch(e.account.status){case"hashed":t.send(S.default.view("signup"));break;case"sigup-posted":t.redirect("/registro/verificar/"+e.account.hash);break;case"sigup-verified":t.redirect("/registro/finalizar/"+e.account.hash);break;case"sigup-finished":case"loged-out":t.redirect("/login");break;case"loged-in":t.redirect("/cuenta");break;case"error":default:t.status(404).send("ERROR")}}},{key:"verifyAccount",value:function(e,t){switch(e.account.status){case"hashed":t.redirect("/registro/crear-cuenta/"+e.account.hash);break;case"sigup-posted":t.send(S.default.view("signup"));break;case"sigup-verified":t.redirect("/registro/finalizar/"+e.account.hash);break;case"sigup-finished":case"loged-out":t.redirect("/login");break;case"loged-in":t.redirect("/cuenta");break;case"error":default:t.status(404).send("ERROR")}}},{key:"finish",value:function(e,t){switch(e.account.status){case"hashed":t.redirect("/registro/crear-cuenta/"+e.account.hash);break;case"sigup-posted":t.redirect("/registro/verificar/"+e.account.hash);break;case"sigup-verified":t.send(S.default.view("signup"));break;case"sigup-finished":case"loged-out":t.redirect("/login");break;case"loged-in":t.redirect("/cuenta");break;case"error":default:t.status(404).send("ERROR")}}},{key:"verifyAccountEmail",value:function(e,t){(0,m.default)(u.default.mark(function n(){return u.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:n.t0=e.account.status,n.next="hashed"===n.t0?3:"sigup-posted"===n.t0?5:"sigup-verified"===n.t0?13:"sigup-finished"===n.t0?15:"loged-out"===n.t0?15:"loged-in"===n.t0?17:(n.t0,19);break;case 3:return t.redirect("/registro/crear-cuenta/"+e.account.hash),n.abrupt("break",20);case 5:if(e.account.user.currentEmail.verificationHash!==e.params.emailHash){n.next=11;break}return n.next=8,e.account.user.updateVerifyEmail(e.account.user.currentEmail);case 8:t.redirect("/registro/finalizar/"+e.account.hash),n.next=12;break;case 11:throw"Error Invalid emailHash";case 12:return n.abrupt("break",20);case 13:return t.redirect("/registro/finalizar/"+e.account.hash),n.abrupt("break",20);case 15:return t.redirect("/login"),n.abrupt("break",20);case 17:return t.redirect("/cuenta"),n.abrupt("break",20);case 19:throw"ERROR";case 20:return n.abrupt("return",e.account.user);case 21:case"end":return n.stop()}},n,this)})).then(function(e){}).catch(function(e){t.status(404).send(e)})}},{key:"statusAccountGET",value:function(t,n){(0,m.default)(u.default.mark(function e(){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.account.status,e.next="hashed"===e.t0?3:"sigup-posted"===e.t0?3:"sigup-verified"===e.t0?3:"sigup-finished"===e.t0?3:"loged-out"===e.t0?3:"loged-in"===e.t0?3:4;break;case 3:return e.abrupt("return",{status:t.account.status});case 4:throw{message:"Error del servidor. <"+t.account.statusMessages+">"};case 5:case"end":return e.stop()}},e,this)})).then(function(e){n.json(e)}).catch(function(t){e.responseStdError(n,w.default.std(t))})}},{key:"signupEmailGET",value:function(t,n){(0,m.default)(u.default.mark(function e(){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.account.status,e.next="sigup-posted"===e.t0?3:"sigup-verified"===e.t0?3:"sigup-finished"===e.t0?3:"loged-out"===e.t0?3:"loged-in"===e.t0?3:6;break;case 3:return e.next=5,t.app.db.emails.findOne({_id:t.account.user.currentEmail.emailRef});case 5:return e.abrupt("return",e.sent);case 6:throw{message:"Error del servidor. <"+t.account.statusMessages+">"};case 7:case"end":return e.stop()}},e,this)})).then(function(e){n.json(e)}).catch(function(t){e.responseStdError(n,w.default.std(t))})}},{key:"createAccountPOST",value:function(t,n){(0,m.default)(u.default.mark(function e(){var n,r;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.account.status,e.next="hashed"===e.t0?3:10;break;case 3:return e.next=5,t.app.db.users.insertOne(t.body);case 5:return n=e.sent,e.next=8,t.app.mailer.send(t.app.mailer.verifyEmailMessageFor(n),t.body.email);case 8:return r=e.sent,e.abrupt("return",n);case 10:throw{message:"Error del servidor. <"+t.account.statusMessages+">"};case 11:case"end":return e.stop()}},e,this)})).then(function(e){n.json(e)}).catch(function(t){e.responseStdError(n,w.default.std(t))})}},{key:"createAccountPasswordPOST",value:function(t,n){(0,m.default)(u.default.mark(function e(){var n;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.account.status,e.next="sigup-verified"===e.t0?3:12;break;case 3:return e.next=5,t.app.auth.sign({hashCode:t.account.user.hashCode,name:t.account.user.name});case 5:return n=e.sent,e.next=8,t.account.user.insertPassword(t.body);case 8:return e.next=10,t.account.user.updateRole({role:"client"});case 10:return console.log(n),e.abrupt("return",{token:n});case 12:throw{message:"Error del servidor. <"+t.account.statusMessages+">"};case 13:case"end":return e.stop()}},e,this)})).then(function(e){n.json(e)}).catch(function(t){e.responseStdError(n,w.default.std(t))})}}],[{key:"responseStdError",value:function(e,t){console.error(y.default.red("ERROR: "+t.message)),e.status(t.responseStatus).json(t)}}]),e}();e.exports=D},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(5),i=r(a),s=n(0),u=r(s),o=n(1),c=r(o),d=n(12),l=r(d),f=n(6),p=r(f),h=n(21),m=r(h),v=function(){function e(){(0,u.default)(this,e),this.router=l.default.Router(),this.router.get("/",this.home.bind(this)),this.router.get("/adm",this.admHome.bind(this)),this.router.get("/adm/inventarios",this.inventory.bind(this)),this.router.get("/adm/inventarios/articulos",this.inventory.bind(this)),this.router.get("/adm/inventarios/articulos/ver/:article",this.inventory.bind(this)),this.router.get("/adm/inventarios/articulos/insertar/:article?",this.inventory.bind(this)),this.router.get("/adm/inventarios/articulos/editar/:article",this.inventory.bind(this)),this.router.get("/adm/inventarios/almacenes",this.inventory.bind(this)),this.router.get("/adm/inventarios/almacenes/ver/:warehouse",this.inventory.bind(this)),this.router.get("/adm/inventarios/almacenes/insertar/:warehouse?",this.inventory.bind(this)),this.router.get("/adm/inventarios/almacenes/editar/:warehouse?",this.inventory.bind(this)),this.router.get("/adm/inventarios/almacenes-entradas",this.inventory.bind(this)),this.router.get("/adm/inventarios/almacenes-entradas/ver/:entry",this.inventory.bind(this)),this.router.get("/adm/inventarios/almacenes-entradas/insertar/:entry?",this.inventory.bind(this)),this.router.get("/adm/inventarios/almacenes-salidas",this.inventory.bind(this)),this.router.get("/adm/inventarios/almacenes-salidas/ver/:entry",this.inventory.bind(this)),this.router.get("/adm/inventarios/almacenes-salidas/insertar/:entry?",this.inventory.bind(this)),this.router.get("/adm/inventarios/proveedores",this.inventory.bind(this)),this.router.get("/adm/inventarios/proveedores/ver/:provider",this.inventory.bind(this)),this.router.get("/adm/inventarios/proveedores/insertar/:provider?",this.inventory.bind(this)),this.router.get("/adm/inventarios/proveedores/editar/:provider",this.inventory.bind(this)),this.router.get("/adm/inventarios/compras",this.inventory.bind(this)),this.router.get("/adm/inventarios/compras/ver/:purchase",this.inventory.bind(this)),this.router.get("/adm/inventarios/compras/insertar/:purchase?",this.inventory.bind(this)),this.router.get("/adm/inventarios/compras/cambiar-estado/:purchase",this.inventory.bind(this)),this.router.get("/adm/inventarios/compras/reporte-fechas/:report",this.inventory.bind(this)),this.router.get("/adm/inventarios/transferencias",this.inventory.bind(this)),this.router.get("/adm/inventarios/transferencias/ver/:transfer",this.inventory.bind(this)),this.router.get("/adm/inventarios/transferencias/insertar/:transfer?",this.inventory.bind(this)),this.router.get("/adm/inventarios/transferencias/cambiar-estado/:transfer",this.inventory.bind(this)),this.router.get("/adm/inventarios/transferencias/reporte-fechas/:report",this.inventory.bind(this)),this.router.use(this.notFound.bind(this))}return(0,c.default)(e,[{key:"companies",value:function(e,t){t.send("LISTA DE EMPRESAS")}},{key:"home",value:function(e,t){t.send(m.default.view("tabletec"))}},{key:"admHome",value:function(e,t){t.send(m.default.view("adm-home"))}},{key:"inventory",value:function(e,t){t.send(m.default.view("inventory"))}},{key:"notFound",value:function(e,t){t.status(404).send(m.default.view("error"))}},{key:"find",value:function(e,t,n){e.params.company?(0,p.default)(i.default.mark(function t(){var n,r;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.app.systemdb.companies.findOne({uniqueName:e.params.company});case 2:return n=t.sent,t.next=5,e.app.dbConnection(n.sysname);case 5:return r=t.sent,t.abrupt("return",{company:n,db:r});case 7:case"end":return t.stop()}},t,this)})).then(function(t){e.company=t.company,e.app.db=t.db,n()}).catch(function(e){n()}):n()}},{key:"validate",value:function(e,t,n){e.company?"active"===e.company.status?n():t.status(406).send(e.company.name+" are "+e.company.status):t.status(404).send("NO COMPANY FOUND")}}]),e}();e.exports=v},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(5),i=r(a),s=n(0),u=r(s),o=n(1),c=r(o),d=n(6),l=r(d),f=n(12),p=r(f),h=n(21),m=r(h),v=n(38),y=r(v),b=n(37),g=r(b),x=n(39),k=r(x),w=n(29),E=r(w),S=n(40),C=r(S),D=function(){function e(){(0,u.default)(this,e);var t=new y.default,n=(new k.default,new g.default),r=new E.default,a=new C.default;this.router=p.default.Router(),this.router.use("/api/seguridad",t.router),this.router.use("/api/cuenta",n.router),this.router.use("/api/empresa/:company",a.find,r.validate,r.router),this.router.use("/build/test",this.buildtest),this.router.use("/empresa/:company",a.find,a.validate,a.router),this.router.use("/empresas",a.companies),this.router.get("/",this.home.bind(this)),this.router.get("/login",this.login.bind(this)),this.router.get("/acerca-de",this.about.bind(this)),this.router.get("/acerca-de/",this.about.bind(this)),this.router.get("/acerca-de/condiciones",this.about.bind(this)),this.router.get("/acerca-de/politica-de-datos",this.about.bind(this)),this.router.get("/cuenta",this.account.bind(this)),this.router.get("/cuenta/perfil",this.account.bind(this)),this.router.get("/cuenta/empresas",this.account.bind(this))}return(0,c.default)(e,[{key:"buildtest",value:function(e,t){(0,l.default)(i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{});case 1:case"end":return e.stop()}},e,this)})).then(function(e){t.send("BUILD SUCCESS")}).catch(function(e){console.log(e),t.status(500).send("ERROR ON BUILD"+e)})}},{key:"home",value:function(e,t){t.send(m.default.view("home"))}},{key:"login",value:function(e,t){t.send(m.default.view("signup"))}},{key:"about",value:function(e,t){t.send(m.default.view("about"))}},{key:"account",value:function(e,t){t.send(m.default.view("account"))}}]),e}();e.exports=D},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(11),i=r(a),s=n(2),u=r(s),o=n(0),c=r(o),d=n(1),l=r(d),f=n(4),p=r(f),h=n(3),m=r(h),v=n(89),y=r(v),b=n(15),g=r(b),x=n(22),k=function(e){function t(e){return(0,c.default)(this,t),(0,p.default)(this,(t.__proto__||(0,u.default)(t)).call(this,e))}return(0,m.default)(t,e),(0,l.default)(t,[{key:"render",value:function(){var e="http://"+this.props.domainName+"/registro/verificar-email/"+this.props.userHash+"/"+this.props.emailHash,t=this.props.companyFrom;return g.default.createElement("div",null,g.default.createElement("img",{src:this.props.logoSrc}),g.default.createElement("b",null,g.default.createElement("br",null),g.default.createElement("br",null),t),g.default.createElement("p",null,"Hola ",this.props.userName),g.default.createElement("p",null,"Haz clic en el siguiente enlace para verificar la dirección de email de tu cuenta de ",t,"®:"),g.default.createElement("a",{href:e},e),g.default.createElement("p",null,"Verificar tu dirección de email te permitirá usar todas las opciones de tu cuenta de ",t,", sin gastos adicionales, en cualquier momento."),g.default.createElement("p",null,"Si deseas más información, ",g.default.createElement("a",null,"haz clic aquí")," para ver las Preguntas Frecuentes o contacta con el equipo de Asistencia de CloudTrade."),g.default.createElement("p",null,"Atentamente,",g.default.createElement("br",null),"Equipo de asistencia de ",t))}}]),t}(g.default.Component);e.exports=function(){function e(){(0,c.default)(this,e),this.siteMail={email:"pao.xaq@gmail.com",password:"pandora132",service:"Gmail"},this.domainName="cloudtrade.ml"}return(0,l.default)(e,[{key:"verifyEmailMessageFor",value:function(e){return{subject:"Correo de verificacion de tu cuenta de CloudTrade - Accion requerida",html:(0,x.renderToString)(g.default.createElement(k,{domainName:this.domainName,userHash:e.hashCode,userName:e.name,emailHash:e.emails[0].verificationHash,companyFrom:"CloudTrade",logoSrc:"https://portal.cloud-trade.com/Resources/light_background_logo.png"}))}}},{key:"send",value:function(e,t,n){return n||(n=this.siteMail),new i.default(function(r,a){var i={service:n.service,auth:{user:n.email,pass:n.password}},s=y.default.createTransport(i),u={from:n.email,to:t,subject:e.subject,html:e.html};s.sendMail(u,function(e,t){e?a(e):r(t.response)})})}}]),e}()},function(e,t,n){"use strict";var r=n(27),a=function(e){return e&&e.__esModule?e:{default:e}}(r);!function(){new a.default}()},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(2),i=r(a),s=n(0),u=r(s),o=n(1),c=r(o),d=n(4),l=r(d),f=n(3),p=r(f),h=n(6),m=(r(h),n(8)),v=r(m),y=n(10),b=r(y),g=n(9),x=r(g),k=n(7),w=r(k),E=function(e){function t(){return(0,u.default)(this,t),(0,l.default)(this,(t.__proto__||(0,i.default)(t)).call(this,{code:{type:String,required:!0,unique:!0,default:t.generateCode},name:{type:String,required:!0,unique:!0},creationDate:{type:String,default:w.default.now},modifiedDate:{type:String,default:w.default.now}}))}return(0,p.default)(t,e),(0,c.default)(t,null,[{key:"generateCode",value:function(){var e=b.default.generate;return e(8)+"-"+e(4)+"-"+e(4)+"-"+e(8)}}]),t}(v.default.Schema);e.exports=function(){function e(t){(0,u.default)(this,e),this.db=t,this.schema=new E,this.model=t.connection.model("ArticleBrand",this.schema)}return(0,c.default)(e,[{key:"findAll",value:function(e){var t=this;return x.default.execTimeout(4e3,function(){return t.model.find({},"code name creationDate modifiedDate")},e)}},{key:"findOne",value:function(e,t,n){var r=this;return x.default.execTimeout(4e3,function(){var n=t||"code name creationDate modifiedDate";return r.model.findOne(e,n)},n)}},{key:"insertOne",value:function(e){}}]),e}()},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(2),i=r(a),s=n(0),u=r(s),o=n(1),c=r(o),d=n(4),l=r(d),f=n(3),p=r(f),h=n(6),m=(r(h),n(8)),v=r(m),y=n(10),b=r(y),g=n(9),x=r(g),k=n(7),w=r(k),E=function(e){function t(){return(0,u.default)(this,t),(0,l.default)(this,(t.__proto__||(0,i.default)(t)).call(this,{code:{type:String,required:!0,unique:!0,default:t.generateCode},name:{type:String,required:!0,unique:!0},creationDate:{type:String,default:w.default.now},modifiedDate:{type:String,default:w.default.now}}))}return(0,p.default)(t,e),(0,c.default)(t,null,[{key:"generateCode",value:function(){var e=b.default.generate;return e(4)+"-"+e(8)+"-"+e(8)+"-"+e(4)}}]),t}(v.default.Schema);e.exports=function(){function e(t){(0,u.default)(this,e),this.db=t,this.schema=new E,this.model=t.connection.model("ArticleCategory",this.schema)}return(0,c.default)(e,[{key:"findAll",value:function(e){var t=this;return x.default.execTimeout(4e3,function(){return t.model.find({},"code name creationDate modifiedDate")},e)}},{key:"findOne",value:function(e,t,n){var r=this;return x.default.execTimeout(4e3,function(){var n=t||"code name creationDate modifiedDate";return r.model.findOne(e,n)},n)}},{key:"insertOne",value:function(e){}}]),e}()},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(5),i=r(a),s=n(11),u=r(s),o=n(2),c=r(o),d=n(0),l=r(d),f=n(1),p=r(f),h=n(4),m=r(h),v=n(3),y=r(v),b=n(6),g=r(b),x=n(8),k=r(x),w=n(10),E=r(w),S=n(9),C=r(S),D=n(7),_=r(D),O=function(e){function t(){(0,l.default)(this,t);var e=new k.default.Schema({code:{type:String,ref:"Image",required:!0},creationDate:{type:String,default:_.default.now},modifiedDate:{type:String,default:_.default.now}}),n=new k.default.Schema({code:{type:String,required:!0},data:{type:Buffer,required:!0},creationDate:{type:String,default:_.default.now},modifiedDate:{type:String,default:_.default.now}}),r=new k.default.Schema({name:{type:String,required:!0},value:{type:String,required:!0}});return(0,m.default)(this,(t.__proto__||(0,c.default)(t)).call(this,{code:{type:String,required:!0,unique:!0,default:t.generateCode},clientCode:{type:String,required:!0,unique:!0},barCode:{type:String,required:!0,unique:!0},name:{type:String,required:!0,unique:!0},description:{type:String,required:!0},brand:{type:String,required:!0},category:{type:String,required:!0},images:[e],dataSheets:[n],customFields:[r],prices:{type:Array},creationDate:{type:String,default:_.default.now},modifiedDate:{type:String,default:_.default.now}}))}return(0,y.default)(t,e),(0,p.default)(t,null,[{key:"generateCode",value:function(){var e=E.default.generate;return e(16)+"-"+e(8)+"-"+e(4)+"-"+e(8)+"-"+e(4)+"-"+e(4)}},{key:"generateImageCode",value:function(){var e=E.default.generate;return e(32)+"-"+e(32)}},{key:"generateDataSheetCode",value:function(){var e=E.default.generate;return e(32)+"-"+e(32)}}]),t}(k.default.Schema);e.exports=function(){function e(t){(0,l.default)(this,e),this.db=t,this.schema=new O,this.model=t.connection.model("Article",this.schema)}return(0,p.default)(e,[{key:"getSchemaColumns",value:function(){return[{name:"code",text:"",visible:!1},{name:"clientCode",text:"Código",visible:!0},{name:"name",text:"Nombre",visible:!0},{name:"brand",text:"Marca",visible:!0},{name:"category",text:"Categoria",visible:!0},{name:"creationDate",text:"Fecha de creación",visible:!0},{name:"modifiedDate",text:"Fecha de modificación",visible:!0}]}},{key:"findAll",value:function(e){var t=this;return C.default.execTimeout(4e3,function(){return t.model.find({},"code clientCode name brand category creationDate modifiedDate")},e)}},{key:"findOne",value:function(e,t){var n=this;return(0,g.default)(i.default.mark(function r(){var a,s;return i.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,C.default.execTimeout(4e3,function(){var r=t||"code clientCode barCode name brand category description images customFields prices creationDate modifiedDate";return n.model.findOne(e,r)});case 2:if(a=r.sent,!a.images){r.next=8;break}return s=a.images.map(function(e){return n.db.images.findOne({code:e.code}).then(function(e){return{code:e.code,data:e.data}})}),r.next=7,u.default.all(s);case 7:a.modImages=r.sent;case 8:return r.abrupt("return",a);case 9:case"end":return r.stop()}},r,this)}))}},{key:"find",value:function(e,t,n){var r=this;return C.default.execTimeout(4e3,function(){var n=t||"code clientCode name brand category creationDate modifiedDate";return r.model.find(e,n)},n)}},{key:"insertOne",value:function(e){var t=this,n=new C.default;return n.run(i.default.mark(function r(){var a,s,u;return i.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.db.articleBrands.findOne({name:e.brand});case 2:return a=r.sent,r.next=5,t.db.articleCategories.findOne({name:e.category});case 5:if(s=r.sent,a){r.next=9;break}return r.next=9,n.insert(t.db.articleBrands.model,{name:e.brand});case 9:if(s){r.next=12;break}return r.next=12,n.insert(t.db.articleCategories.model,{name:e.category});case 12:return r.next=14,n.insert(t.model,e);case 14:return u=r.sent,r.abrupt("return",u);case 16:case"end":return r.stop()}},r,this)}))}},{key:"updateOne",value:function(e,t){var n=this,r=new C.default;return r.run(i.default.mark(function a(){var s,u,o;return i.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,n.db.articleBrands.findOne({name:t.brand});case 2:return s=a.sent,a.next=5,n.db.articleCategories.findOne({name:t.category});case 5:if(u=a.sent,s){a.next=9;break}return a.next=9,r.insert(n.db.articleBrands.model,{name:t.brand});case 9:if(u){a.next=12;break}return a.next=12,r.insert(n.db.articleCategories.model,{name:t.category});case 12:return t.modifiedDate=_.default.now(),a.next=15,r.update(n.model,e,t);case 15:return o=a.sent,a.abrupt("return",n.findOne(e));case 17:case"end":return a.stop()}},a,this)}))}}]),e}()},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(2),i=r(a),s=n(0),u=r(s),o=n(1),c=r(o),d=n(4),l=r(d),f=n(3),p=r(f),h=n(6),m=(r(h),n(8)),v=r(m),y=n(10),b=r(y),g=n(9),x=r(g),k=n(7),w=r(k),E=function(e){function t(){return(0,u.default)(this,t),(0,l.default)(this,(t.__proto__||(0,i.default)(t)).call(this,{code:{type:String,required:!0,unique:!0,default:t.generateCode},name:{type:String,required:!0},country:{type:String},creationDate:{type:String,default:w.default.now},modifiedDate:{type:String,default:w.default.now}}))}return(0,p.default)(t,e),(0,c.default)(t,null,[{key:"generateCode",value:function(){var e=b.default.generate;return e(6)+"-"+e(6)+"-"+e(8)+"-"+e(6)+"-"+e(6)}}]),t}(v.default.Schema);e.exports=function(){function e(t){(0,u.default)(this,e),this.db=t,this.schema=new E,this.model=t.connection.model("City",this.schema)}return(0,c.default)(e,[{key:"findAll",value:function(e){var t=this;return x.default.execTimeout(4e3,function(){return t.model.find({},"code name country creationDate modifiedDate")},e)}},{key:"findOne",value:function(e,t,n){var r=this;return x.default.execTimeout(4e3,function(){var n=t||"code name country creationDate modifiedDate";return r.model.findOne(e,n)},n)}},{key:"insertOne",value:function(e){}}]),e}()},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(5),i=r(a),s=n(2),u=r(s),o=n(0),c=r(o),d=n(1),l=r(d),f=n(4),p=r(f),h=n(3),m=r(h),v=n(6),y=(r(v),n(8)),b=r(y),g=n(10),x=r(g),k=n(26),w=r(k),E=n(9),S=r(E),C=n(7),D=r(C),_=function(e){function t(){(0,c.default)(this,t);var e=(0,p.default)(this,(t.__proto__||(0,u.default)(t)).call(this,{code:{type:String,required:!0,unique:!0,default:t.generateCode},uniqueName:{type:String,required:!0,unique:!0},name:{type:String,required:!0},sysname:{type:String,required:!0,unique:!0},status:{type:String,required:!0,default:"active"},creationDate:{type:String,default:D.default.now},modifiedDate:{type:String,default:D.default.now}}));return e.path("uniqueName").validate(function(e){return w.default.isAlphanumeric(e,"es-ES")},"El campo 'uniqueName' debe ser alfanumérico"),e}return(0,m.default)(t,e),(0,l.default)(t,null,[{key:"generateCode",value:function(){var e=x.default.generate;return e(4)+"-"+e(8)+"-"+e(4)+"-"+e(8)}}]),t}(b.default.Schema);e.exports=function(){function e(t){(0,c.default)(this,e),this.db=t,this.schema=new _,this.model=t.connection.model("Company",this.schema)}return(0,l.default)(e,[{key:"findOne",value:function(e,t){var n=this;return S.default.execTimeout(4e3,function(){return n.model.findOne(e)},t)}},{key:"insertOne",value:function(e){var t=this,n=new S.default;return n.run(i.default.mark(function r(){var a;return i.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return e.sysname="co_"+x.default.generate({length:8,charset:"hex"})+"_"+e.uniqueName,r.next=3,n.insert(t.model,e);case 3:return a=r.sent,r.abrupt("return",a);case 5:case"end":return r.stop()}},r,this)}))}}]),e}()},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(0),i=r(a),s=n(1),u=r(s),o=n(8),c=r(o),d=n(82),l=r(d),f=n(17),p=r(f),h=n(50),m=r(h),v=n(57),y=r(v),b=n(48),g=r(b),x=n(52),k=r(x),w=n(47),E=r(w),S=n(51),C=r(S),D=n(46),_=r(D),O=n(44),q=r(O),T=n(45),A=r(T),N=n(53),P=r(N),R=n(61),W=r(R),j=n(58),M=r(j),z=n(59),B=r(z),F=n(60),I=r(F),U=n(62),H=r(U),G=n(63),L=r(G),Y=n(54),V=r(Y),K=n(56),J=r(K),Z=n(55),X=r(Z);c.default.Promise=global.Promise;var Q=function(){function e(t,n,r){var a=this;(0,i.default)(this,e),this.isConnected=!1,this.connection=c.default.createConnection(),this.connection.on("error",this.onError.bind(this)),this.connection.on("connecting",function(){}),this.connection.on("connected",function(){console.log(p.default.green("[DB] connected to:",t.db)),a.isConnected=!0,r&&r(null,a)}),this.connection.on("disconnected",function(){console.log(p.default.yellow("[DB] disconnected from:",t.db)),a.isConnected=!1}),this.connection.on("reconnected",function(){console.log(p.default.green("[DB] reconnected to:",t.db)),a.isConnected=!0}),this.connection.on("close",this.onClose.bind(this));var s="mongodb://";s=t.user&&t.user.length>0?s+t.user+":"+t.pass+"@"+t.host+":"+t.port+"/"+t.db:s+t.host+":"+t.port+"/"+t.db,this.connection.open(s,{server:{reconnectTries:Number.MAX_VALUE}}).then(function(){}).catch(function(e){console.log(e),r&&r(e)}),n?(this.emails=new m.default(this),this.users=new y.default(this),this.companies=new g.default(this)):(this.images=new k.default(this),this.cities=new E.default(this),this.staff=new C.default(this),this.articles=new _.default(this),this.articleBrands=new q.default(this),this.articleCategories=new A.default(this),this.providers=new P.default(this),this.warehouses=new W.default(this),this.warehouseEntries=new M.default(this),this.warehouseEntryPurchases=new B.default(this),this.warehouseEntryTransfers=new I.default(this),this.warehouseOutlets=new H.default(this),this.warehouseOutletTransfers=new L.default(this),this.purchases=new V.default(this),this.transfers=new J.default(this),this.reports=new X.default(this))}return(0,u.default)(e,[{key:"onError",value:function(e){console.log("DB Error",e)}},{key:"onReconnected",value:function(){console.log("DB reconnected")}},{key:"onClose",value:function(){console.log("DB close")}}]),e}(),$=function(){function e(t){(0,i.default)(this,e),this.connections=new l.default,this.cnnopt={host:t.connection.host,port:t.connection.port,user:t.connection.user,pass:t.connection.pass,db:t.connection.sysdb},this.systemdb=new Q(this.cnnopt,!0)}return(0,u.default)(e,[{key:"connection",value:function(e,t){var n={host:this.cnnopt.host,port:this.cnnopt.port,user:this.cnnopt.user,pass:this.cnnopt.pass,db:e},r=this.connections;if(r.has(e)){var a=r.get(e);a.isConnected&&t(null,a)}else{var i=new Q(n,!1,t);r.set(e,i)}}}]),e}();e.exports=$},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(5),i=r(a),s=n(2),u=r(s),o=n(0),c=r(o),d=n(1),l=r(d),f=n(4),p=r(f),h=n(3),m=r(h),v=n(8),y=r(v),b=n(10),g=r(b),x=n(26),k=r(x),w=n(9),E=r(w),S=n(7),C=r(S),D=function(e){function t(){(0,c.default)(this,t);var e=(0,p.default)(this,(t.__proto__||(0,u.default)(t)).call(this,{code:{type:String,required:!0,unique:!0,default:t.generateCode},email:{type:String,required:!0,unique:!0},creationDate:{type:String,default:C.default.now},modifiedDate:{type:String,default:C.default.now}}));return e.path("email").validate(function(e){return k.default.isEmail(e)},"El campo 'email' no es válido"),e}return(0,m.default)(t,e),(0,l.default)(t,null,[{key:"generateCode",value:function(){var e=g.default.generate;return e(8)+"-"+e(8)+"-"+e(8)+"-"+e(8)}}]),t}(y.default.Schema);e.exports=function(){function e(t){(0,c.default)(this,e),this.db=t,this.schema=new D,this.model=t.connection.model("Email",this.schema)}return(0,l.default)(e,[{key:"findOne",value:function(e,t){var n=this;return E.default.execTimeout(4e3,function(){return n.model.findOne(e)},t)}},{key:"insertOne",value:function(e){var t=this,n=new E.default;return n.run(i.default.mark(function r(){var a;return i.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.insert(t.model,e);case 2:return a=r.sent,r.abrupt("return",a);case 4:case"end":return r.stop()}},r,this)}))}}]),e}()},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(5),i=r(a),s=n(1),u=r(s),o=n(2),c=r(o),d=n(0),l=r(d),f=n(4),p=r(f),h=n(3),m=r(h),v=n(8),y=r(v),b=n(10),g=(r(b),n(9)),x=r(g),k=n(7),w=r(k),E=function(e){function t(){return(0,l.default)(this,t),(0,p.default)(this,(t.__proto__||(0,c.default)(t)).call(this,{code:{type:String,required:!0,unique:!0},role:{type:String,required:!0},creationDate:{type:String,default:w.default.now},modifiedDate:{type:String,default:w.default.now}}))}return(0,m.default)(t,e),t}(y.default.Schema);e.exports=function(){function e(t){(0,l.default)(this,e),this.db=t,this.schema=new E,this.model=t.connection.model("Employee",this.schema)}return(0,u.default)(e,[{key:"findOne",value:function(e,t){var n=this;return x.default.execTimeout(4e3,function(){return n.model.findOne(e)},t)}},{key:"insertOne",value:function(e){var t=this,n=new x.default;return n.run(i.default.mark(function r(){var a;return i.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.insert(t.model,e);case 2:return a=r.sent,r.abrupt("return",a);case 4:case"end":return r.stop()}},r,this)}))}}]),e}()},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(5),i=r(a),s=n(2),u=r(s),o=n(0),c=r(o),d=n(1),l=r(d),f=n(4),p=r(f),h=n(3),m=r(h),v=n(8),y=r(v),b=n(10),g=r(b),x=n(9),k=r(x),w=n(7),E=r(w),S=function(e){function t(){return(0,c.default)(this,t),(0,p.default)(this,(t.__proto__||(0,u.default)(t)).call(this,{code:{type:String,required:!0,unique:!0,default:t.generateCode},data:{type:Buffer,required:!0},mimetype:{type:String,required:!0},creationDate:{type:String,default:E.default.now},modifiedDate:{type:String,default:E.default.now}}))}return(0,m.default)(t,e),(0,l.default)(t,null,[{key:"generateCode",value:function(){var e=g.default.generate;return e(32)+"-"+e(8)+"-"+e(32)}}]),t}(y.default.Schema);e.exports=function(){function e(t){(0,c.default)(this,e),this.db=t,this.schema=new S,this.model=t.connection.model("Image",this.schema)}return(0,l.default)(e,[{key:"findOne",value:function(e,t,n){var r=this;return k.default.execTimeout(4e3,function(){var n=t||"code data type creationDate modifiedDate";return r.model.findOne(e,n)},n)}},{key:"insertOne",value:function(e){var t=this,n=new k.default;return n.run(i.default.mark(function r(){var a;return i.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.insert(t.model,e);case 2:return a=r.sent,r.abrupt("return",a);case 4:case"end":return r.stop()}},r,this)}))}}]),e}()},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(5),i=r(a),s=n(2),u=r(s),o=n(0),c=r(o),d=n(1),l=r(d),f=n(4),p=r(f),h=n(3),m=r(h),v=n(6),y=(r(v),n(8)),b=r(y),g=n(10),x=r(g),k=n(9),w=r(k),E=n(7),S=r(E),C=function(e){function t(){return(0,c.default)(this,t),(0,p.default)(this,(t.__proto__||(0,u.default)(t)).call(this,{code:{type:String,required:!0,unique:!0,default:t.generateCode},nit:{type:String,required:!0,unique:!0},name:{type:String,required:!0},phone:{type:String,required:!0},country:{type:String,required:!0},city:{type:String,required:!0},description:{type:String},email:{type:String},address:{type:String},creationDate:{type:String,default:S.default.now},modifiedDate:{type:String,default:S.default.now}}))}return(0,m.default)(t,e),(0,l.default)(t,null,[{key:"generateCode",value:function(){var e=x.default.generate;return e(8)+"-"+e(4)+"-"+e(8)+"-"+e(4)}}]),t}(b.default.Schema);e.exports=function(){function e(t){(0,c.default)(this,e),this.db=t,this.schema=new C,this.model=t.connection.model("Providers",this.schema)}return(0,l.default)(e,[{key:"getSchemaColumns",value:function(){return[{name:"code",text:"",visible:!1},{name:"nit",text:"NIT",visible:!0},{name:"name",text:"Nombre",visible:!0},{name:"country",text:"País",visible:!0},{name:"city",text:"Ciudad",visible:!0},{name:"phone",text:"Teléfono",visible:!0},{name:"email",text:"Correo electrónico",visible:!0},{name:"address",text:"Dirección",visible:!0},{name:"description",text:"Descripción",visible:!0},{name:"creationDate",text:"Fecha de creación",visible:!0},{name:"modifiedDate",text:"Fecha de modificación",visible:!0}]}},{key:"findAll",value:function(e){var t=this;return w.default.execTimeout(4e3,function(){return t.model.find({},"code nit name description email address country city phone creationDate modifiedDate")},e)}},{key:"findOne",value:function(e,t,n){var r=this;return w.default.execTimeout(4e3,function(){var n=t||"code nit name description email address country city phone creationDate modifiedDate";return r.model.findOne(e,n)},n)}},{key:"insertOne",value:function(e){var t=this,n=new w.default;return n.run(i.default.mark(function r(){var a,s;return i.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.db.cities.findOne({name:e.city});case 2:if(a=r.sent){r.next=6;break}return r.next=6,n.insert(t.db.cities.model,{name:e.city});case 6:return r.next=8,n.insert(t.model,e);case 8:return s=r.sent,r.abrupt("return",s);case 10:case"end":return r.stop()}},r,this)}))}},{key:"updateOne",value:function(e,t){var n=this,r=new w.default;return r.run(i.default.mark(function a(){var s,u;return i.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,n.db.cities.findOne({name:t.city});case 2:if(s=a.sent){a.next=6;break}return a.next=6,r.insert(n.db.cities.model,{name:t.city});case 6:return t.modifiedDate=S.default.now(),a.next=9,r.update(n.model,e,t);case 9:return u=a.sent,a.abrupt("return",n.findOne(e));case 11:case"end":return a.stop()}},a,this)}))}}]),e}()},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(5),i=r(a),s=n(11),u=r(s),o=n(2),c=r(o),d=n(0),l=r(d),f=n(1),p=r(f),h=n(4),m=r(h),v=n(3),y=r(v),b=n(6),g=r(b),x=n(8),k=r(x),w=n(10),E=r(w),S=n(9),C=r(S),D=n(7),_=r(D),O=function(e){function t(){(0,l.default)(this,t);var e=new k.default.Schema({code:{type:String,ref:"Article",required:!0},quantity:{type:Number,min:1,required:!0},unitPrice:{type:Number,required:!0},measurement:{type:String,required:!0},remark:{type:String}}),n=(0,m.default)(this,(t.__proto__||(0,c.default)(t)).call(this,{code:{type:String,required:!0,unique:!0,default:t.generateCode},business:{type:String,required:!0},order:{type:String},guideNumber:{type:String,required:!0,unique:!0},status:{type:String,required:!0,default:"created"},providerCode:{type:String,ref:"Provider",required:!0},contactName:{type:String},payDate:{type:String},billingDir:{type:String,required:!0},billingCountry:{type:String},billingDep:{type:String},shippingDir:{type:String,required:!0},shippingCountry:{type:String},shippingDep:{type:String},shippingProvince:{type:String},shippingPostal:{type:String},terms:{type:String},description:{type:String},articles:[e],creationDate:{type:String,default:_.default.now},modifiedDate:{type:String,default:_.default.now}}));return n.path("articles").validate(function(e){return e.length},"El campo 'articles' no puede ser un array vacío"),n.methods.addField=n.addField,n}return(0,y.default)(t,e),(0,p.default)(t,[{key:"addField",value:function(e,t){this[e]=t,console.log(this[e])}}],[{key:"generateCode",value:function(){var e=E.default.generate;return e(16)+"-"+e(16)+"-"+e(16)}}]),t}(k.default.Schema);e.exports=function(){function e(t){(0,l.default)(this,e),this.db=t,this.schema=new O,this.model=t.connection.model("Purchase",this.schema)}return(0,p.default)(e,[{key:"getSchemaColumns",value:function(){return[{name:"code",text:"Código",visible:!1},{name:"guideNumber",text:"Número de guía",visible:!0},{name:"business",text:"Asunto",visible:!0},{name:"order",text:"Referencia del pedido",visible:!0},{name:"status",text:"Estado",visible:!0},{name:"providerName",text:"Nombre del proveedor",visible:!0},{name:"contactName",text:"Nombre de contacto",visible:!0},{name:"payDate",text:"Fecha de pago",visible:!0},{name:"billingDir",text:"Derección de facturación",visible:!0},{name:"shippingDir",text:"Derección de envío",visible:!0},{name:"description",text:"Descripción",visible:!0},{name:"creationDate",text:"Fecha de creación",visible:!0},{name:"modifiedDate",text:"Fecha de modificación",visible:!0}]}},{key:"findAll",value:function(){return this.find({})}},{key:"find",value:function(e,t){var n=this;return(0,g.default)(i.default.mark(function r(){var a,s;return i.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,C.default.execTimeout(4e3,function(){var r=t||"code business order guideNumber status providerCode contactName payDate billingDir shippingDir description creationDate modifiedDate";return n.model.find(e,r)});case 2:return a=r.sent,s=a.map(function(e){return n.db.providers.findOne({code:e.providerCode},"name").then(function(t){e.providerName=t.name})}),r.next=6,u.default.all(s);case 6:return r.abrupt("return",a);case 7:case"end":return r.stop()}},r,this)}))}},{key:"findOne",value:function(e,t){var n=this;return(0,g.default)(i.default.mark(function r(){var a,s,o;return i.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,C.default.execTimeout(4e3,function(){var r=t||"code business order guideNumber status providerCode contactName payDate billingDir billingCountry billingDep shippingDir shippingCountry shippingDep shippingProvince shippingPostal terms description articles creationDate modifiedDate";return n.model.findOne(e,r)});case 2:if(a=r.sent){r.next=5;break}throw"No se ha encontrado la compra";case 5:if(!a.providerCode){r.next=10;break}return r.next=8,n.db.providers.findOne({code:a.providerCode},"code name");case 8:s=r.sent,a.modProvider={code:s.code,name:s.name};case 10:if(!a.articles){r.next=15;break}return o=a.articles.map(function(e){return n.db.articles.findOne({code:e.code},"code name").then(function(t){return{code:t.code,name:t.name,quantity:e.quantity,unitPrice:e.unitPrice,measurement:e.measurement,remark:e.remark}})}),r.next=14,u.default.all(o);case 14:a.modArticles=r.sent;case 15:return r.abrupt("return",a);case 16:case"end":return r.stop()}},r,this)}))}},{key:"insertOne",value:function(e){var t=this,n=new C.default;return n.run(i.default.mark(function r(){var a;return i.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.insert(t.model,e);case 2:return a=r.sent,r.abrupt("return",a);case 4:case"end":return r.stop()}},r,this)}))}},{key:"updateOneStatus",value:function(e){var t=this,n=new C.default;return n.run(i.default.mark(function r(){var a;return i.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.update(t.model,{code:e.code},{status:e.status,modifiedDate:_.default.now()});case 2:return a=r.sent,r.abrupt("return",t.findOne({code:e.code}));case 4:case"end":return r.stop()}},r,this)}))}}]),e}()},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(5),i=r(a),s=n(2),u=r(s),o=n(0),c=r(o),d=n(1),l=r(d),f=n(4),p=r(f),h=n(3),m=r(h),v=n(6),y=(r(v),n(8)),b=r(y),g=n(88),x=(r(g),n(10)),k=r(x),w=n(9),E=r(w),S=n(7),C=r(S),D=function(e){function t(){return(0,c.default)(this,t),(0,p.default)(this,(t.__proto__||(0,u.default)(t)).call(this,{code:{type:String,required:!0,unique:!0,default:t.generateCode},name:{type:String,required:!0},seq:{type:Number,required:!0},htmlResult:{type:String},creationDate:{type:String,default:C.default.now}}))}return(0,m.default)(t,e),(0,l.default)(t,null,[{key:"generateCode",value:function(){var e=k.default.generate;return e(4)+"-"+e(16)+"-"+e(4)}}]),t}(b.default.Schema);e.exports=function(){function e(t){(0,c.default)(this,e),this.db=t,this.schema=new D,this.model=t.connection.model("Report",this.schema)}return(0,l.default)(e,[{key:"insertOne",value:function(e){var t=this,n=new E.default;return n.run(i.default.mark(function r(){var a,s;return i.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.model.findOne().sort({seq:-1}).exec();case 2:return a=r.sent,e.seq=a?a.seq+1:1001,r.next=6,n.insert(t.model,e);case 6:return s=r.sent,r.abrupt("return",s);case 8:case"end":return r.stop()}},r,this)}))}}]),e}()},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(5),i=r(a),s=n(11),u=r(s),o=n(2),c=r(o),d=n(0),l=r(d),f=n(1),p=r(f),h=n(4),m=r(h),v=n(3),y=r(v),b=n(6),g=r(b),x=n(8),k=r(x),w=n(10),E=r(w),S=n(9),C=r(S),D=n(7),_=r(D),O=function(e){function t(){(0,l.default)(this,t);var e=new k.default.Schema({code:{type:String,ref:"Article",required:!0},quantity:{type:Number,min:1,required:!0},unitPrice:{type:Number,required:!0},remark:{type:String}}),n=(0,m.default)(this,(t.__proto__||(0,c.default)(t)).call(this,{code:{type:String,required:!0,unique:!0,default:t.generateCode},seq:{type:Number,required:!0,unique:!0},business:{type:String,required:!0},status:{type:String,required:!0,default:"created"},originWarehouseCode:{type:String,ref:"Warehouse",required:!0},destinationWarehouseCode:{type:String,ref:"Warehouse",required:!0},description:{type:String},articles:[e],creationDate:{type:String,default:_.default.now},modifiedDate:{type:String,default:_.default.now}}));return n.path("articles").validate(function(e){return e.length},"El campo 'articles' no puede ser un array vacío"),n}return(0,y.default)(t,e),(0,p.default)(t,null,[{key:"generateCode",value:function(){var e=E.default.generate;return e(16)+"-"+e(32)}}]),t}(k.default.Schema);e.exports=function(){function e(t){(0,l.default)(this,e),this.db=t,this.schema=new O,this.model=t.connection.model("Transfer",this.schema)}return(0,p.default)(e,[{key:"getSchemaColumns",value:function(){return[{name:"code",text:"code",visible:!1},{name:"seq",text:"Número",visible:!0},{name:"business",text:"Asunto",visible:!0},{name:"status",text:"Estado",visible:!0},{name:"originWarehouseName",text:"Almacén origen",visible:!0},{name:"destinationWarehouseName",text:"Almacén destino",visible:!0},{name:"description",text:"Descripción",visible:!0},{name:"creationDate",text:"Fecha de creación",visible:!0},{name:"modifiedDate",text:"Fecha de modificación",visible:!0}]}},{key:"findAllPlane",value:function(e,t){var n=this;return C.default.execTimeout(4e3,function(){var t=e||"code seq business status description creationDate";return n.model.find({},t)},t)}},{key:"findAll",value:function(){return this.find({})}},{key:"findOne",value:function(e,t){var n=this;return(0,g.default)(i.default.mark(function r(){var a,s,o,c;return i.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,C.default.execTimeout(4e3,function(){var r=t||"code seq business status originWarehouseCode destinationWarehouseCode description articles creationDate modifiedDate";return n.model.findOne(e,r)});case 2:if(a=r.sent){r.next=5;break}throw"No se ha encontrado la transferencia";case 5:if(!a.originWarehouseCode){r.next=10;break}return r.next=8,n.db.warehouses.model.findOne({code:a.originWarehouseCode});case 8:s=r.sent,a.originWarehouse={code:s.code,name:s.name};case 10:if(!a.destinationWarehouseCode){r.next=15;break}return r.next=13,n.db.warehouses.model.findOne({code:a.destinationWarehouseCode});case 13:o=r.sent,a.destinationWarehouse={code:o.code,name:o.name};case 15:if(!a.articles){r.next=20;break}return c=a.articles.map(function(e){return n.db.articles.model.findOne({code:e.code},"code name brand").then(function(t){return{code:t.code,name:t.name,brand:t.brand,quantity:e.quantity,unitPrice:e.unitPrice,remark:e.remark}})}),r.next=19,u.default.all(c);case 19:a.modArticles=r.sent;case 20:return r.abrupt("return",a);case 21:case"end":return r.stop()}},r,this)}))}},{key:"find",value:function(e,t){var n=this;return(0,g.default)(i.default.mark(function r(){var a,s,o;return i.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,C.default.execTimeout(4e3,function(){var r=t||"code seq business status originWarehouseCode destinationWarehouseCode description creationDate modifiedDate";return n.model.find(e,r)});case 2:return a=r.sent,s=a.map(function(e){return n.db.warehouses.model.findOne({code:e.originWarehouseCode}).then(function(t){e.originWarehouseName=t.name})}),o=a.map(function(e){return n.db.warehouses.model.findOne({code:e.destinationWarehouseCode}).then(function(t){e.destinationWarehouseName=t.name})}),r.next=7,u.default.all(s);case 7:return r.next=9,u.default.all(o);case 9:return r.abrupt("return",a);case 10:case"end":return r.stop()}},r,this)}))}},{key:"insertOne",value:function(e){var t=this,n=new C.default;return n.run(i.default.mark(function r(){var a,s;return i.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.model.findOne().sort({seq:-1}).exec();case 2:return a=r.sent,e.seq=a?a.seq+1:1001,r.next=6,n.insert(t.model,e);case 6:return s=r.sent,r.abrupt("return",s);case 8:case"end":return r.stop()}},r,this)}))}},{key:"updateOneStatus",value:function(e){var t=this,n=new C.default;return n.run(i.default.mark(function r(){var a;return i.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.update(t.model,{code:e.code},{status:e.status,modifiedDate:_.default.now()});case 2:return a=r.sent,r.abrupt("return",t.findOne({code:e.code}));case 4:case"end":return r.stop()}},r,this)}))}}]),e}()},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(5),i=r(a),s=n(11),u=r(s),o=n(2),c=r(o),d=n(0),l=r(d),f=n(1),p=r(f),h=n(4),m=r(h),v=n(3),y=r(v),b=n(6),g=r(b),x=n(8),k=r(x),w=n(79),E=r(w),S=n(10),C=r(S),D=n(9),_=r(D),O=n(7),q=r(O),T="79IHEKr3Yq5PNMU1w095t1poNb66xAk5-08skXdhVGJPll9YKEShewJM1wjWG52hp-mKEmSOBVA0fc5yNCeS0AoE4idDAxhHvH",A=function(e){function t(){(0,l.default)(this,t);var e=new k.default.Schema({code:{type:String,ref:"Email",required:!0,unique:!0},current:{type:Boolean,required:!0,default:!0},verified:{type:Boolean,required:!0,default:!1},verificationHash:{type:String,required:!0,unique:!0,default:t.generateEmailVerificationHash},creationDate:{type:String,default:q.default.now},modifiedDate:{type:String,default:q.default.now}}),n=new k.default.Schema({encrypted:{type:String,required:!0},current:{type:Boolean,required:!0,default:!0},creationDate:{type:String,default:q.default.now},modifiedDate:{type:String,default:q.default.now}}),r=new k.default.Schema({data:{type:Buffer,required:!0},current:{type:Boolean,required:!0,default:!1},creationDate:{type:String,default:q.default.now},modifiedDate:{type:String,default:q.default.now}}),a=new k.default.Schema({code:{type:String,ref:"Company",required:!0},role:{type:String}}),i=(0,m.default)(this,(t.__proto__||(0,c.default)(t)).call(this,{code:{type:String,required:!0,unique:!0,default:t.generateCode},clientHash:{type:String,required:!0,unique:!0},usename:{type:String},name:{type:String,required:!0},emails:[e],passwords:[n],profileImages:[r],companies:[a],role:{type:String,required:!0,default:"undefined"},creationDate:{type:String,default:q.default.now},modifiedDate:{type:String,default:q.default.now}}));return i.path("emails").validate(function(e){return e.length},"El campo 'emails' no puede ser un array vacío"),i.methods.auth=i.auth,i.methods.insertPassword=i.insertPassword,i.methods.updateVerifyEmail=i.updateVerifyEmail,i.methods.updateRole=i.updateRole,i.methods.addCompany=i.addCompany,i}return(0,y.default)(t,e),(0,p.default)(t,[{key:"auth",value:function(e){var n=this;return new u.default(function(r,a){var i=n.passwords.find(function(e){return!0===e.current});if(i){t.decryptText(i.encrypted)===e.password?r(i):a({responseStatus:406,message:"La contraseña no es válida"})}else a({responseStatus:406,message:"El usuario no tiene contraseña"})})}},{key:"insertPassword",value:function(e){var n=this;return _.default.execTimeout(4e3,function(){var r=n.passwords.find(function(e){return!0===e.current});return r&&(r.current=!1,r.modifiedDate=q.default.now()),n.passwords.push({encrypted:t.encryptText(e.password)}),n.save()})}},{key:"updateVerifyEmail",value:function(e){var t=this,n=this.emails.find(function(t){return t.verificationHash===e.verificationHash});return n?(n.verified=!0,n.modifiedDate=q.default.now(),_.default.execTimeout(4e3,function(){return t.save()})):new u.default(function(e,t){t("Clave de verificación de email inválido")})}},{key:"updateRole",value:function(e){var t=this;return _.default.execTimeout(4e3,function(){return t.role=e.role,t.modifiedDate=q.default.now(),t.save()})}},{key:"addCompany",value:function(e){var t=this;return _.default.execTimeout(4e3,function(){return t.companies.push({code:e.code}),t.save()})}}],[{key:"encryptText",value:function(e){var t=E.default.createCipher("aes-256-ctr",T),n=t.update(e,"utf8","hex");return n+=t.final("hex")}},{key:"decryptText",value:function(e){var t=E.default.createDecipher("aes-256-ctr",T),n=t.update(e,"hex","utf8");return n+=t.final("utf8")}},{key:"generateCode",value:function(){var e=C.default.generate;return e(8)+"-"+e(16)+"-"+e(8)}},{key:"generateEmailVerificationHash",value:function(){var e=C.default.generate;return e(32)+"-"+e(32)+"-"+e(32)}}]),t}(k.default.Schema);e.exports=function(){function e(t){(0,l.default)(this,e),this.db=t,this.schema=new A,this.model=t.connection.model("User",this.schema)}return(0,p.default)(e,[{key:"findOne",value:function(e,t){var n=this;return _.default.execTimeout(4e3,function(){return n.model.findOne(e)},t)}},{key:"findOneByEmail",value:function(e){var t=this;return(0,g.default)(i.default.mark(function n(){var r,a;return i.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.db.emails.findOne({email:e.email});case 2:if(r=n.sent){n.next=5;break}throw{responseStatus:406,message:"El correo electrónico "+e.email+" no está registrado"};case 5:return n.next=7,_.default.execTimeout(4e3,function(){return t.model.findOne({"emails.code":r.code})});case 7:return a=n.sent,n.abrupt("return",a);case 9:case"end":return n.stop()}},n,this)}))}},{key:"insertOne",value:function(e){var t=this,n=new _.default;return n.run(i.default.mark(function r(){var a,s,u;return i.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.db.emails.findOne({email:e.email});case 2:if(!(a=r.sent)){r.next=5;break}throw{responseStatus:406,message:"El correo electrónico "+e.email+" ya fue registrado. Porfavor intente usar un correo electrónico diferente"};case 5:return r.next=7,n.insert(t.db.emails.model,{email:e.email});case 7:return s=r.sent,r.next=10,n.insert(t.model,{clientHash:e.clientHash,usename:e.usename,name:e.name,emails:[{code:s.code}]});case 10:return u=r.sent,r.abrupt("return",u);case 12:case"end":return r.stop()}},r,this)}))}}]),e}()},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(5),i=r(a),s=n(2),u=r(s),o=n(0),c=r(o),d=n(1),l=r(d),f=n(4),p=r(f),h=n(3),m=r(h),v=n(6),y=r(v),b=n(8),g=r(b),x=n(10),k=r(x),w=n(9),E=r(w),S=n(7),C=r(S),D=function(e){function t(){return(0,c.default)(this,t),(0,p.default)(this,(t.__proto__||(0,u.default)(t)).call(this,{code:{type:String,required:!0,unique:!0,default:t.generateCode},transactionsTypeName:{type:String,required:!0},description:{type:String,required:!0,unique:!0},entryDate:{type:String,required:!0},creationDate:{type:String,default:C.default.now},modifiedDate:{type:String,default:C.default.now}}))}return(0,m.default)(t,e),(0,l.default)(t,null,[{key:"generateCode",value:function(){var e=k.default.generate;return e(8)+"-"+e(8)+"-"+e(8)+"-"+e(8)}}]),t}(g.default.Schema);e.exports=function(){function e(t){(0,c.default)(this,e),this.db=t,this.schema=new D,this.model=t.connection.model("WarehouseEntry",this.schema)}return(0,l.default)(e,[{key:"getSchemaColumns",value:function(){return[{name:"code",text:"Código",visible:!1},{name:"transactionsTypeName",text:"Concepto",visible:!0},{name:"description",text:"Descripción",visible:!0},{name:"entryDate",text:"Fecha de entrada",visible:!0},{name:"creationDate",text:"Fecha de creación",visible:!0},{name:"modifiedDate",text:"Fecha de modificación",visible:!0}]}},{key:"findAll",value:function(){return this.find({})}},{key:"find",value:function(e,t){var n=this;return(0,y.default)(i.default.mark(function r(){var a;return i.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,E.default.execTimeout(4e3,function(){var r=t||"code transactionsTypeName description entryDate creationDate modifiedDate";return n.model.find(e,r)});case 2:return a=r.sent,r.abrupt("return",a);case 4:case"end":return r.stop()}},r,this)}))}},{key:"findOne",value:function(e,t,n){var r=this;return E.default.execTimeout(4e3,function(){var n=t||"code transactionsTypeName description entryDate creationDate modifiedDate";return r.model.findOne(e,n)},n)}}]),e}()},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(11),i=r(a),s=n(5),u=r(s),o=n(16),c=r(o),d=n(1),l=r(d),f=n(2),p=r(f),h=n(0),m=r(h),v=n(4),y=r(v),b=n(3),g=r(b),x=n(6),k=r(x),w=n(8),E=r(w),S=n(9),C=r(S),D=n(7),_=r(D),O=function(e){function t(){(0,m.default)(this,t);var e=new E.default.Schema({code:{type:String,ref:"Article",required:!0},warehouseCode:{type:String,ref:"Warehouse",required:!0},quantity:{type:Number,min:0,required:!0},remark:{type:String}}),n=new E.default.Schema({code:{type:String,ref:"Purchase",required:!0},articles:[e]}),r=(0,y.default)(this,(t.__proto__||(0,p.default)(t)).call(this,{code:{type:String,required:!0,unique:!0,ref:"WarehouseEntry"},transactions:[n],creationDate:{type:String,default:_.default.now},modifiedDate:{type:String,default:_.default.now}}));return n.path("articles").validate(function(e){return e.length},"El campo 'articles' no puede ser un array vacío"),r.path("transactions").validate(function(e){return e.length},"El campo 'transactions' no puede ser un array vacío"),r}return(0,g.default)(t,e),t}(E.default.Schema);e.exports=function(){function e(t){(0,m.default)(this,e),this.db=t,this.schema=new O,this.model=t.connection.model("WarehouseEntryPurchase",this.schema)}return(0,l.default)(e,[{key:"findAll",value:function(e){var t=this;return C.default.execTimeout(4e3,function(){var n=e||"code transactions creationDate modifiedDate";return t.model.find({},n)})}},{key:"findOne",value:function(e,t){var n=this;return(0,k.default)(u.default.mark(function r(){var a,s,o,d,l,f,p,h,m;return u.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,C.default.execTimeout(4e3,function(){var r=t||"code transactions creationDate modifiedDate";return n.model.findOne(e,r)});case 2:if(a=r.sent,!a.transactions){r.next=43;break}a.modTransactions=[],s=!0,o=!1,d=void 0,r.prev=8,l=(0,c.default)(a.transactions);case 10:if(s=(f=l.next()).done){r.next=29;break}return p=f.value,r.next=14,n.db.purchases.findOne({code:p.code},"code business");case 14:if(h=r.sent){r.next=17;break}throw"Referencia a compra perdida";case 17:return m=p.articles.map(function(e){return(0,k.default)(u.default.mark(function t(){var r,a;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.db.warehouses.findOne({code:e.warehouseCode},"code name");case 2:if(r=t.sent){t.next=5;break}throw"Referencia a almacén perdida";case 5:return t.next=7,n.db.articles.findOne({code:e.code},"code name");case 7:return a=t.sent,t.abrupt("return",{code:a.code,name:a.name,quantity:e.quantity,warehouseCode:e.warehouseCode,warehouseName:r.name,remark:e.remark});case 9:case"end":return t.stop()}},t,this)}))}),r.t0=a.modTransactions,r.t1=h.code,r.t2=h.business,r.next=23,i.default.all(m);case 23:r.t3=r.sent,r.t4={code:r.t1,business:r.t2,articles:r.t3},r.t0.push.call(r.t0,r.t4);case 26:s=!0,r.next=10;break;case 29:r.next=35;break;case 31:r.prev=31,r.t5=r.catch(8),o=!0,d=r.t5;case 35:r.prev=35,r.prev=36,!s&&l.return&&l.return();case 38:if(r.prev=38,!o){r.next=41;break}throw d;case 41:return r.finish(38);case 42:return r.finish(35);case 43:return r.abrupt("return",a);case 44:case"end":return r.stop()}},r,this,[[8,31,35,43],[36,,38,42]])}))}},{key:"insertOne",value:function(e){var t=this,n=new C.default;return n.run(u.default.mark(function r(){var a,i,s,o,d,l,f,p,h,m,v,y,b,g,x=this;return u.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.insert(t.db.warehouseEntries.model,e);case 2:return a=r.sent,e.code=a.code,r.next=6,n.insert(t.model,e);case 6:i=r.sent,s=!0,o=!1,d=void 0,r.prev=10,l=(0,c.default)(e.transactions);case 12:if(s=(f=l.next()).done){r.next=44;break}p=f.value,h=!0,m=!1,v=void 0,r.prev=17,y=u.default.mark(function e(){var r,a,i;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=g.value,e.next=3,t.db.warehouses.findOne({code:r.warehouseCode},"code articles");case 3:if(a=e.sent){e.next=6;break}throw"Referencia a almacén perdida";case 6:return i=a.articles.find(function(e){return e.code===r.code}),i?i.stock=i.stock+r.quantity:a.articles.push({code:r.code,stock:r.quantity}),e.next=10,n.update(t.db.warehouses.model,{code:r.warehouseCode},{articles:a.articles,modifiedDate:_.default.now()});case 10:case"end":return e.stop()}},e,x)}),b=(0,c.default)(p.articles);case 20:if(h=(g=b.next()).done){r.next=25;break}return r.delegateYield(y(),"t0",22);case 22:h=!0,r.next=20;break;case 25:r.next=31;break;case 27:r.prev=27,r.t1=r.catch(17),m=!0,v=r.t1;case 31:r.prev=31,r.prev=32,!h&&b.return&&b.return();case 34:if(r.prev=34,!m){r.next=37;break}throw v;case 37:return r.finish(34);case 38:return r.finish(31);case 39:return r.next=41,n.update(t.db.purchases.model,{code:p.code},{status:p.status||"joined",modifiedDate:_.default.now()});case 41:s=!0,r.next=12;break;case 44:r.next=50;break;case 46:r.prev=46,r.t2=r.catch(10),o=!0,d=r.t2;case 50:r.prev=50,r.prev=51,!s&&l.return&&l.return();case 53:if(r.prev=53,!o){r.next=56;break}throw d;case 56:return r.finish(53);case 57:return r.finish(50);case 58:return r.abrupt("return",i);case 59:case"end":return r.stop()}},r,this,[[10,46,50,58],[17,27,31,39],[32,,34,38],[51,,53,57]])}))}}]),e}()},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(11),i=r(a),s=n(5),u=r(s),o=n(16),c=r(o),d=n(1),l=r(d),f=n(2),p=r(f),h=n(0),m=r(h),v=n(4),y=r(v),b=n(3),g=r(b),x=n(6),k=r(x),w=n(8),E=r(w),S=n(9),C=r(S),D=n(7),_=r(D),O=function(e){function t(){(0,m.default)(this,t);var e=new E.default.Schema({code:{type:String,ref:"Article",required:!0},warehouseCode:{type:String,ref:"Warehouse",required:!0},quantity:{type:Number,min:0,required:!0},remark:{type:String}}),n=new E.default.Schema({code:{type:String,ref:"Transfer",required:!0},articles:[e]}),r=(0,y.default)(this,(t.__proto__||(0,p.default)(t)).call(this,{code:{type:String,required:!0,unique:!0,ref:"WarehouseEntry"},transactions:[n],creationDate:{type:String,default:_.default.now},modifiedDate:{type:String,default:_.default.now}}));return n.path("articles").validate(function(e){return e.length},"El campo 'articles' no puede ser un array vacío"),r.path("transactions").validate(function(e){return e.length},"El campo 'transactions' no puede ser un array vacío"),r}return(0,g.default)(t,e),t}(E.default.Schema);e.exports=function(){function e(t){(0,m.default)(this,e),this.db=t,this.schema=new O,this.model=t.connection.model("WarehouseEntryTransfer",this.schema)}return(0,l.default)(e,[{key:"findAll",value:function(e){var t=this;return C.default.execTimeout(4e3,function(){var n=e||"code transactions creationDate modifiedDate";return t.model.find({},n)})}},{key:"findOne",value:function(e,t){var n=this;return(0,k.default)(u.default.mark(function r(){var a,s,o,d,l,f,p,h,m;return u.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,C.default.execTimeout(4e3,function(){var r=t||"code transactions creationDate modifiedDate";return n.model.findOne(e,r)});case 2:if(a=r.sent,!a.transactions){r.next=43;break}a.modTransactions=[],s=!0,o=!1,d=void 0,r.prev=8,l=(0,c.default)(a.transactions);case 10:if(s=(f=l.next()).done){r.next=29;break}return p=f.value,r.next=14,n.db.transfers.findOne({code:p.code},"code business");case 14:if(h=r.sent){r.next=17;break}throw"Referencia a transferencia perdida";case 17:return m=p.articles.map(function(e){return(0,k.default)(u.default.mark(function t(){var r,a;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.db.warehouses.findOne({code:e.warehouseCode},"code name");case 2:if(r=t.sent){t.next=5;break}throw"Referencia a almacén perdida";case 5:return t.next=7,n.db.articles.findOne({code:e.code},"code name");case 7:return a=t.sent,t.abrupt("return",{code:a.code,name:a.name,quantity:e.quantity,warehouseCode:e.warehouseCode,warehouseName:r.name,remark:e.remark});case 9:case"end":return t.stop()}},t,this)}))}),r.t0=a.modTransactions,r.t1=h.code,r.t2=h.business,r.next=23,i.default.all(m);case 23:r.t3=r.sent,r.t4={code:r.t1,business:r.t2,articles:r.t3},r.t0.push.call(r.t0,r.t4);case 26:s=!0,r.next=10;break;case 29:r.next=35;break;case 31:r.prev=31,r.t5=r.catch(8),o=!0,d=r.t5;case 35:r.prev=35,r.prev=36,!s&&l.return&&l.return();case 38:if(r.prev=38,!o){r.next=41;break}throw d;case 41:return r.finish(38);case 42:return r.finish(35);case 43:return r.abrupt("return",a);case 44:case"end":return r.stop()}},r,this,[[8,31,35,43],[36,,38,42]])}))}},{key:"insertOne",value:function(e){var t=this,n=new C.default;return n.run(u.default.mark(function r(){var a,i,s,o,d,l,f,p,h,m,v,y,b,g,x=this;return u.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.insert(t.db.warehouseEntries.model,e);case 2:return a=r.sent,e.code=a.code,r.next=6,n.insert(t.model,e);case 6:i=r.sent,s=!0,o=!1,d=void 0,r.prev=10,l=(0,c.default)(e.transactions);case 12:if(s=(f=l.next()).done){r.next=44;break}p=f.value,h=!0,m=!1,v=void 0,r.prev=17,y=u.default.mark(function e(){var r,a,i;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=g.value,e.next=3,t.db.warehouses.findOne({code:r.warehouseCode},"code articles");case 3:if(a=e.sent){e.next=6;break}throw"Referencia a almacén perdida";case 6:return i=a.articles.find(function(e){return e.code===r.code}),i?i.stock=i.stock+r.quantity:a.articles.push({code:r.code,stock:r.quantity}),e.next=10,n.update(t.db.warehouses.model,{code:r.warehouseCode},{articles:a.articles,modifiedDate:_.default.now()});case 10:case"end":return e.stop()}},e,x)}),b=(0,c.default)(p.articles);case 20:if(h=(g=b.next()).done){r.next=25;break}return r.delegateYield(y(),"t0",22);case 22:h=!0,r.next=20;break;case 25:r.next=31;break;case 27:r.prev=27,r.t1=r.catch(17),m=!0,v=r.t1;case 31:r.prev=31,r.prev=32,!h&&b.return&&b.return();case 34:if(r.prev=34,!m){r.next=37;break}throw v;case 37:return r.finish(34);case 38:return r.finish(31);case 39:return r.next=41,n.update(t.db.transfers.model,{code:p.code},{status:p.status||"joined",modifiedDate:_.default.now()});case 41:s=!0,r.next=12;break;case 44:r.next=50;break;case 46:r.prev=46,r.t2=r.catch(10),o=!0,d=r.t2;case 50:r.prev=50,r.prev=51,!s&&l.return&&l.return();case 53:if(r.prev=53,!o){r.next=56;break}throw d;case 56:return r.finish(53);case 57:return r.finish(50);case 58:return r.abrupt("return",i);case 59:case"end":return r.stop()}},r,this,[[10,46,50,58],[17,27,31,39],[32,,34,38],[51,,53,57]])}))}}]),e}()},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(5),i=r(a),s=n(11),u=r(s),o=n(2),c=r(o),d=n(0),l=r(d),f=n(1),p=r(f),h=n(4),m=r(h),v=n(3),y=r(v),b=n(6),g=r(b),x=n(8),k=r(x),w=n(10),E=r(w),S=n(9),C=r(S),D=n(7),_=r(D),O=function(e){function t(){(0,l.default)(this,t);var e=new k.default.Schema({code:{type:String,ref:"Article",required:!0},stock:{type:Number,min:0,required:!0,default:0}}),n=(0,m.default)(this,(t.__proto__||(0,c.default)(t)).call(this,{code:{type:String,required:!0,unique:!0,default:t.generateCode},clientCode:{type:String,required:!0,unique:!0},name:{type:String,required:!0,unique:!0},type:{type:String,required:!0},country:{type:String,required:!0},city:{type:String,required:!0,ref:"City"},address:{type:String,required:!0},phone:{type:String},postcode:{type:String},articles:[e],creationDate:{type:String,default:_.default.now},modifiedDate:{type:String,default:_.default.now}}));return n.methods.findAllStockOn=n.findAllStockOn,n}return(0,y.default)(t,e),(0,p.default)(t,[{key:"findAllStockOn",value:function(e){var t=this;return(0,g.default)(i.default.mark(function n(){return i.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.articles){n.next=6;break}return n.next=3,u.default.all(t.articles.map(function(t){return e.findOne({code:t.code}).then(function(e){return{code:e.code,name:e.name,brand:e.brand,category:e.category,stock:t.stock}})}));case 3:n.t0=n.sent,n.next=7;break;case 6:n.t0=[];case 7:return n.abrupt("return",n.t0);case 8:case"end":return n.stop()}},n,this)}))}}],[{key:"generateCode",value:function(){var e=E.default.generate;return e(16)+"-"+e(16)}}]),t}(k.default.Schema);e.exports=function(){function e(t){(0,l.default)(this,e),this.db=t,this.schema=new O,this.model=t.connection.model("Warehouse",this.schema)}return(0,p.default)(e,[{key:"getSchemaColumns",value:function(){return[{name:"code",text:"",visible:!1},{name:"clientCode",text:"Código",visible:!0},{name:"name",text:"Nombre",visible:!0},{name:"type",text:"Tipo",visible:!0},{name:"country",text:"País",visible:!0},{name:"city",text:"Ciudad",visible:!0},{name:"address",text:"Dirección",visible:!0},{name:"phone",text:"Teléfono",visible:!0},{name:"postcode",text:"Código postal",visible:!0},{name:"creationDate",text:"Fecha de creación",visible:!0},{name:"modifiedDate",text:"Fecha de modificación",visible:!0}]}},{key:"findAll",value:function(e,t){var n=this;return C.default.execTimeout(4e3,function(){var t=e||"code clientCode name type country city address phone postcode creationDate modifiedDate";return n.model.find({},t)},t)}},{key:"findOne",value:function(e,t,n){var r=this;return C.default.execTimeout(4e3,function(){var n=t||"code clientCode name type country city address phone postcode articles creationDate modifiedDate";return r.model.findOne(e,n)},n)}},{key:"insertOne",value:function(e){var t=this,n=new C.default;return n.run(i.default.mark(function r(){var a,s;return i.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.db.cities.findOne({name:e.city});case 2:if(a=r.sent){r.next=6;break}return r.next=6,n.insert(t.db.cities.model,{name:e.city});case 6:return r.next=8,n.insert(t.model,e);case 8:return s=r.sent,r.abrupt("return",s);case 10:case"end":return r.stop()}},r,this)}))}},{key:"updateOne",value:function(e,t){var n=this,r=new C.default;return r.run(i.default.mark(function a(){var s,u;return i.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,n.db.cities.findOne({name:t.city});case 2:if(s=a.sent){a.next=6;break}return a.next=6,r.insert(n.db.cities.model,{name:t.city});case 6:return t.modifiedDate=_.default.now(),a.next=9,r.update(n.model,e,t);case 9:return u=a.sent,a.abrupt("return",n.findOne(e));case 11:case"end":return a.stop()}},a,this)}))}}]),e}()},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(5),i=r(a),s=n(2),u=r(s),o=n(0),c=r(o),d=n(1),l=r(d),f=n(4),p=r(f),h=n(3),m=r(h),v=n(6),y=r(v),b=n(8),g=r(b),x=n(10),k=r(x),w=n(9),E=r(w),S=n(7),C=r(S),D=function(e){function t(){return(0,c.default)(this,t),(0,p.default)(this,(t.__proto__||(0,u.default)(t)).call(this,{code:{type:String,required:!0,unique:!0,default:t.generateCode},transactionsTypeName:{type:String,required:!0},description:{type:String,required:!0,unique:!0},outletDate:{type:String,required:!0},creationDate:{type:String,default:C.default.now},modifiedDate:{type:String,default:C.default.now}}))}return(0,m.default)(t,e),(0,l.default)(t,null,[{key:"generateCode",value:function(){var e=k.default.generate;return e(8)+"-"+e(8)+"-"+e(8)+"-"+e(8)}}]),t}(g.default.Schema);e.exports=function(){function e(t){(0,c.default)(this,e),this.db=t,this.schema=new D,this.model=t.connection.model("WarehouseOutlet",this.schema)}return(0,l.default)(e,[{key:"getSchemaColumns",value:function(){return[{name:"code",text:"Código",visible:!1},{name:"transactionsTypeName",text:"Concepto",visible:!0},{name:"description",text:"Descripción",visible:!0},{name:"outletDate",text:"Fecha de salida",visible:!0},{name:"creationDate",text:"Fecha de creación",visible:!0},{name:"modifiedDate",text:"Fecha de modificación",visible:!0}]}},{key:"findAll",value:function(){return this.find({})}},{key:"find",value:function(e,t){var n=this;return(0,y.default)(i.default.mark(function r(){var a;return i.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,E.default.execTimeout(4e3,function(){var r=t||"code transactionsTypeName description outletDate creationDate modifiedDate";return n.model.find(e,r)});case 2:return a=r.sent,r.abrupt("return",a);case 4:case"end":return r.stop()}},r,this)}))}},{key:"findOne",value:function(e,t){var n=this;return(0,y.default)(i.default.mark(function r(){var a;return i.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,E.default.execTimeout(4e3,function(){var r=t||"code transactionsTypeName description outletDate creationDate modifiedDate";return n.model.findOne(e,r)});case 2:return a=r.sent,r.abrupt("return",a);case 4:case"end":return r.stop()}},r,this)}))}}]),e}()},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(11),i=r(a),s=n(5),u=r(s),o=n(16),c=r(o),d=n(1),l=r(d),f=n(2),p=r(f),h=n(0),m=r(h),v=n(4),y=r(v),b=n(3),g=r(b),x=n(6),k=r(x),w=n(8),E=r(w),S=n(9),C=r(S),D=n(7),_=r(D),O=function(e){function t(){(0,m.default)(this,t);var e=new E.default.Schema({code:{type:String,ref:"Article",required:!0},warehouseCode:{type:String,ref:"Warehouse",required:!0},quantity:{type:Number,min:0,required:!0},remark:{type:String}}),n=new E.default.Schema({code:{type:String,ref:"Transfer",required:!0},articles:[e]}),r=(0,y.default)(this,(t.__proto__||(0,p.default)(t)).call(this,{code:{type:String,required:!0,unique:!0,ref:"WarehouseOutlet"},transactions:[n],creationDate:{type:String,default:_.default.now},modifiedDate:{type:String,default:_.default.now}}));return n.path("articles").validate(function(e){return e.length},"El campo 'articles' no puede ser un array vacío"),r.path("transactions").validate(function(e){return e.length},"El campo 'transactions' no puede ser un array vacío"),r}return(0,g.default)(t,e),t}(E.default.Schema);e.exports=function(){function e(t){(0,m.default)(this,e),this.db=t,this.schema=new O,this.model=t.connection.model("WarehouseOutletTransfer",this.schema)}return(0,l.default)(e,[{key:"findAll",value:function(e){var t=this;return C.default.execTimeout(4e3,function(){var n=e||"code transactions creationDate modifiedDate";return t.model.find({},n)})}},{key:"findOne",value:function(e,t){var n=this;return(0,k.default)(u.default.mark(function r(){var a,s,o,d,l,f,p,h,m;return u.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,C.default.execTimeout(4e3,function(){var r=t||"code transactions creationDate modifiedDate";return n.model.findOne(e,r)});case 2:if(a=r.sent,!a.transactions){r.next=43;break}a.modTransactions=[],s=!0,o=!1,d=void 0,r.prev=8,l=(0,c.default)(a.transactions);case 10:if(s=(f=l.next()).done){r.next=29;break}return p=f.value,r.next=14,n.db.transfers.findOne({code:p.code},"code business");case 14:if(h=r.sent){r.next=17;break}throw"Referencia a transferencia perdida";case 17:return m=p.articles.map(function(e){return(0,k.default)(u.default.mark(function t(){var r,a;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.db.warehouses.findOne({code:e.warehouseCode},"code name");case 2:if(r=t.sent){t.next=5;break}throw"Referencia a almacén perdida";case 5:return t.next=7,n.db.articles.findOne({code:e.code},"code name");case 7:return a=t.sent,t.abrupt("return",{code:a.code,name:a.name,warehouseCode:e.warehouseCode,warehouseName:r.name,quantity:e.quantity,remark:e.remark});case 9:case"end":return t.stop()}},t,this)}))}),r.t0=a.modTransactions,r.t1=h.code,r.t2=h.business,r.next=23,i.default.all(m);case 23:r.t3=r.sent,r.t4={code:r.t1,business:r.t2,articles:r.t3},r.t0.push.call(r.t0,r.t4);case 26:s=!0,r.next=10;break;case 29:r.next=35;break;case 31:r.prev=31,r.t5=r.catch(8),o=!0,d=r.t5;case 35:r.prev=35,r.prev=36,!s&&l.return&&l.return();case 38:if(r.prev=38,!o){r.next=41;break}throw d;case 41:return r.finish(38);case 42:return r.finish(35);case 43:return r.abrupt("return",a);case 44:case"end":return r.stop()}},r,this,[[8,31,35,43],[36,,38,42]])}))}},{key:"insertOne",value:function(e){var t=this,n=new C.default;return n.run(u.default.mark(function r(){var a,i,s,o,d,l,f,p,h,m,v,y,b,g,x=this;return u.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.insert(t.db.warehouseOutlets.model,e);case 2:return a=r.sent,e.code=a.code,r.next=6,n.insert(t.model,e);case 6:i=r.sent,s=!0,o=!1,d=void 0,r.prev=10,l=(0,c.default)(e.transactions);case 12:if(s=(f=l.next()).done){r.next=44;break}p=f.value,h=!0,m=!1,v=void 0,r.prev=17,y=u.default.mark(function e(){var r,a,i,s;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=g.value,e.next=3,t.db.warehouses.findOne({code:r.warehouseCode},"code articles");case 3:if(a=e.sent){e.next=6;break}throw"Referencia a almacén perdida";case 6:return i=a.articles.find(function(e){return e.code===r.code}),i?(s=i.stock-r.quantity,i.stock=s>0?s:0):a.articles.push({code:r.code,stock:0}),e.next=10,n.update(t.db.warehouses.model,{code:r.warehouseCode},{articles:a.articles,modifiedDate:_.default.now()});case 10:case"end":return e.stop()}},e,x)}),b=(0,c.default)(p.articles);case 20:if(h=(g=b.next()).done){r.next=25;break}return r.delegateYield(y(),"t0",22);case 22:h=!0,r.next=20;break;case 25:r.next=31;break;case 27:r.prev=27,r.t1=r.catch(17),m=!0,v=r.t1;case 31:r.prev=31,r.prev=32,!h&&b.return&&b.return();case 34:if(r.prev=34,!m){r.next=37;break}throw v;case 37:return r.finish(34);case 38:return r.finish(31);case 39:return r.next=41,n.update(t.db.transfers.model,{code:p.code},{status:p.status||"withdrawn",modifiedDate:_.default.now()});case 41:s=!0,r.next=12;break;case 44:r.next=50;break;case 46:r.prev=46,r.t2=r.catch(10),o=!0,d=r.t2;case 50:r.prev=50,r.prev=51,!s&&l.return&&l.return();case 53:if(r.prev=53,!o){r.next=56;break}throw d;case 56:return r.finish(53);case 57:return r.finish(50);case 58:return r.abrupt("return",i);case 59:case"end":return r.stop()}},r,this,[[10,46,50,58],[17,27,31,39],[32,,34,38],[51,,53,57]])}))}}]),e}()},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(2),i=r(a),s=n(0),u=r(s),o=n(1),c=r(o),d=n(4),l=r(d),f=n(3),p=r(f),h=n(15),m=r(h);e.exports=function(e){function t(e){return(0,u.default)(this,t),(0,l.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e))}return(0,p.default)(t,e),(0,c.default)(t,[{key:"render",value:function(){return m.default.createElement("head",null,this.props.children,this.props.styleSheets.map(function(e,t){return m.default.createElement("link",{key:t,rel:"stylesheet",type:"text/css",href:e})}),this.props.scripts?this.props.scripts.map(function(e,t){return m.default.createElement("script",{key:t,src:e})}):null,m.default.createElement("meta",{name:"viewport",content:"width=device-width, user-scalable=yes, initial-scale=1, maximum-scale=1"}),m.default.createElement("title",null,this.props.title))}}]),t}(m.default.Component)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(2),i=r(a),s=n(0),u=r(s),o=n(1),c=r(o),d=n(4),l=r(d),f=n(3),p=r(f),h=n(15),m=r(h);e.exports=function(e){function t(e){return(0,u.default)(this,t),(0,l.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e))}return(0,p.default)(t,e),(0,c.default)(t,[{key:"render",value:function(){return m.default.createElement("body",null,this.props.scripts.map(function(e,t){return m.default.createElement("script",{key:t,src:e})}))}}]),t}(m.default.Component)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(2),i=r(a),s=n(0),u=r(s),o=n(4),c=r(o),d=n(3),l=r(d),f=n(14),p=r(f);e.exports=function(e){function t(e){return(0,u.default)(this,t),(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e,"about"))}return(0,l.default)(t,e),t}(p.default)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(2),i=r(a),s=n(0),u=r(s),o=n(4),c=r(o),d=n(3),l=r(d),f=n(14),p=r(f);e.exports=function(e){function t(e){return(0,u.default)(this,t),(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e,"account"))}return(0,l.default)(t,e),t}(p.default)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(2),i=r(a),s=n(0),u=r(s),o=n(4),c=r(o),d=n(3),l=r(d),f=n(14),p=r(f);e.exports=function(e){function t(e){return(0,u.default)(this,t),(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e,"adm-home"))}return(0,l.default)(t,e),t}(p.default)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(2),i=r(a),s=n(0),u=r(s),o=n(4),c=r(o),d=n(3),l=r(d),f=n(14),p=r(f);e.exports=function(e){function t(e){return(0,u.default)(this,t),(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e,"error"))}return(0,l.default)(t,e),t}(p.default)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(2),i=r(a),s=n(0),u=r(s),o=n(4),c=r(o),d=n(3),l=r(d),f=n(14),p=r(f);e.exports=function(e){function t(e){return(0,u.default)(this,t),(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e,"home"))}return(0,l.default)(t,e),t}(p.default)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(2),i=r(a),s=n(0),u=r(s),o=n(4),c=r(o),d=n(3),l=r(d),f=n(14),p=r(f);e.exports=function(e){function t(e){return(0,u.default)(this,t),(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e,"inventory"))}return(0,l.default)(t,e),t}(p.default)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(2),i=r(a),s=n(0),u=r(s),o=n(4),c=r(o),d=n(3),l=r(d),f=n(14),p=r(f);e.exports=function(e){function t(e){return(0,u.default)(this,t),(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e,"signup"))}return(0,l.default)(t,e),t}(p.default)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(2),i=r(a),s=n(0),u=r(s),o=n(4),c=r(o),d=n(3),l=r(d),f=n(14),p=r(f);e.exports=function(e){function t(e){return(0,u.default)(this,t),(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e,"tabletec"))}return(0,l.default)(t,e),t}(p.default)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=n(0),i=r(a),s=n(1),u=r(s),o=n(25),c=r(o),d=n(18),l=r(d),f=n(77),p=r(f);e.exports=function(){function e(){(0,i.default)(this,e)}return(0,u.default)(e,null,[{key:"load",value:function(e){var t=e?e+".theme.json":"default.theme.json",n=l.default.join(__dirname,"themes",t);try{return JSON.parse(c.default.readFileSync(n,"utf8"))}catch(e){return console.error(p.default.red('ERROR: No se pudo abrir el archivo "'+n+'"')),{name:"default",version:"0.01",htmlColor:"#01579b",colorName:"light-blue darken-4",styleSheets:[],scripts:["/js/jquery.js"],routes:[{name:"home",scripts:["/js/tabletec.default.home.js"]}]}}}}]),e}()},function(e,t){e.exports=require("babel-runtime/core-js/json/stringify")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("colors/safe")},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("express-fileupload")},function(e,t){e.exports=require("file-type")},function(e,t){e.exports=require("hashmap")},function(e,t){e.exports=require("html-pdf")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("jsonfile")},function(e,t){e.exports=require("jsonwebtoken")},function(e,t){e.exports=require("moment")},function(e,t){e.exports=require("mongoose-auto-increment")},function(e,t){e.exports=require("nodemailer")},function(e,t){e.exports=require("passport-custom")},function(e,t){e.exports=require("request")},function(e,t){e.exports=require("stream-to-array")}]);